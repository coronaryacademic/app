<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&display=swap"
  rel="stylesheet"
/>

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap"
  rel="stylesheet"
/>

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
  rel="stylesheet"
/>

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
  rel="stylesheet"
/>

<!-- Environment Configuration -->
<script>
  // Set environment variables for API access
  window.ENV = window.ENV || {};
  // These values will be replaced with actual values during deployment
  window.ENV.MISTRAL_API_KEY = "{{MISTRAL_API_KEY}}";
  window.ENV.GITHUB_MODELS_TOKEN = "{{GITHUB_MODELS_TOKEN}}";
</script>

<style>
  /* Defensive override: any element inside history form that explicitly used white-ish bg */
  #history-form-container * {
    /* neutralize hard-coded white backgrounds without affecting layout */
    background: var(--header-bg) !important;
    color: var(--all-text);
  }

  /* JS moved out of <style> into script section */

  /* Exception: PE checkbox should maintain its custom styling */
  #history-form-container .pe-checkbox {
    background: transparent !important;
    margin-top: 10px;
  }

  #history-form-container .pe-checkbox:checked {
    background: rgb(86, 212, 254) !important;
  }

  /* Prevent scroll chaining/jumps inside PE section on iOS */
  #pe-content {
    overscroll-behavior: contain;
  }

  /* Allow PE accordion content to show when toggled */
  #history-form-container .pe-accordion-content[style*="display: block"] {
    display: block !important;
  }

  /* Force inline black text to use theme color inside BAU form */
  #history-form-container [style*="color: black"],
  #history-form-container [style*="color:black"],
  #history-form-container [style*="color: Black"],
  #history-form-container [style*="color:#000"],
  #history-form-container [style*="color: #000"],
  #history-form-container [style*="color:#000000"],
  #history-form-container [style*="color: #000000"],
  #history-form-container [style*="color: rgb(0, 0, 0)"],
  #history-form-container [style*="color:rgb(0,0,0)"] {
    color: var(--all-text) !important;
  }

  body {
    scrollbar-width: thin;
    scrollbar-color: rgba(150, 150, 150, 0.5) transparent;
  }
</style>

<script type="module" src="cont/00.bau/bau-new.js"></script>
<script src="src/student-autofill.js"></script>

<script>
  // Function to toggle PE Others input fields
  function togglePEOthersInput(checkboxId, textInputId) {
    const checkbox = document.getElementById(checkboxId);
    const textInput = document.getElementById(textInputId);

    if (checkbox && textInput) {
      if (checkbox.checked) {
        textInput.disabled = false;
        textInput.style.opacity = "1";
        textInput.focus();
      } else {
        textInput.disabled = true;
        textInput.style.opacity = "0.6";
        textInput.value = "";
      }
    }
  }
</script>

<div
  style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fff;
    background: radial-gradient(
        circle at 20% 30%,
        rgba(52, 164, 162, 0.35),
        transparent 60%
      ),
      radial-gradient(
        circle at 80% 20%,
        rgba(173, 216, 230, 0.25),
        transparent 60%
      ),
      radial-gradient(
        circle at 70% 80%,
        rgba(186, 85, 211, 0.168),
        transparent 60%
      ),
      radial-gradient(
        circle at 30% 70%,
        rgba(255, 182, 193, 0.123),
        transparent 60%
      );
    background-blend-mode: screen;
    z-index: -1;
  "
></div>

<style>
  .warning-box {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin: 35px auto; /* keeps it centered */
    padding: 1rem 1.5rem;
    max-width: calc(720px - 34px); /* subtracts 17px from each side */
    width: calc(100% - 34px); /* keeps at least 17px margin */
    border: 2px solid #dc2626;
    border-radius: 12px;
    background-color: #fee2e2;
    color: #b91c1c;
    font-family: Arial, sans-serif;
    font-size: 15px;
    line-height: 1.6;
    box-shadow: 0 4px 8px rgba(220, 38, 38, 0.2);
    position: relative;
  }

  .warning-box svg {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    fill: #dc2626;
    margin-top: 2px;
  }

  .warning-close-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: none;
    border: none;
    color: #dc2626;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background-color 0.2s;
  }

  .warning-close-btn:hover {
    background-color: rgba(220, 38, 38, 0.1);
  }
</style>

<!-- First Warning -->
<div class="warning-box" id="warning-box">
  <button class="warning-close-btn" onclick="closeWarningBox()" title="Close warning">&times;</button>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path
      d="M12 2L1 21h22L12 2zm0 14a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm-1-7h2v5h-2V9z"
    />
  </svg>
  <span>
    The report generated by this app should <strong>NOT</strong> be exposed nor
    shared with anyone in the faculty, even the tutor. It is intended only to
    help students organize ideas and prepare for possible case discussions. It
    is <strong>not for cheating</strong> or reliance, only for summarizing and
    structuring thought. The student should write his/her own summary and
    history in order to give it to the tutor. Patient name or details must
    <strong>never</strong> be shared unless allowed by them. The
    <strong>investigation and differential diagnosis AI summary</strong> should
    not be discussed with others. Since this is an introductory course, it is
    only meant to connect history and physical exam with results, making sense
    of the patient's true case. It is strictly for learning and linking ideas.
  </span>
</div>

<!-- Form Container -->
<div
  id="history-form-container"
  class="form-wrapper"
  style="
    width: 95%;
    max-width: 900px;
    margin: 35px auto 0 auto;
    margin-top: 17px;
    margin-bottom: -55px;
    padding: 28px 32px;
    background-color: var(--header-bg);
    border: 1px solid var(--borderbottomdark);
  "
>
  <!-- Load saved history message -->
  <div
    id="load-history-message"
    style="
      background: var(--userdiv);
      border-radius: 12px;
      border: none;
      padding: 16px 20px;
      margin-bottom: 0;
      text-align: center;
      color: var(--all-text);
      font-size: 14px;
      font-weight: 500;
      display: none;
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    "
  >
    New form is loaded
  </div>

  <label style="font-size: 26px; margin-bottom: 32px; font-weight: 600"
    >Patient information
  </label>
  <!-- Patient Info in One Row -->
  <div
    id="section-patient-info"
    class="form-section flex-row"
    style="
      margin-top: -10px;
      border-bottom: 1px solid var(--all-text);
      padding-bottom: 37px;
    "
  >
    <div class="form-subsection">
      <label for="patient-name" style="font-size: 17px">Patient Name</label>
      <input
        type="text"
        id="patient-name"
        style="
          width: 100%;
          box-sizing: border-box;
          padding: 8px;
          font-size: 14px;
        "
      />
    </div>

    <div class="form-subsection">
      <label for="age" style="font-size: 17px">Age</label>
      <input
        type="number"
        id="age"
        min="0"
        max="120"
        step="1"
        inputmode="numeric"
        style="
          width: 100%;
          box-sizing: border-box;
          padding: 8px;
          font-size: 14px;
        "
        oninput="{ const raw = this.value; const digits = raw.replace(/[^0-9]/g,''); if (digits === '') { this.value = ''; return; } let n = parseInt(digits, 10); if (Number.isNaN(n)) { this.value = ''; return; } if (n < 0) n = 0; if (n > 120) n = 120; this.value = String(n); }"
      />
    </div>

    <div class="form-subsection">
      <label for="gender" style="font-size: 17px">Gender</label>
      <select
        id="gender"
        style="
          width: 100%;
          box-sizing: border-box;
          padding: 8px;
          font-size: 14px;
        "
      >
        <option value="" disabled selected>Select gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
    </div>
  </div>

  <!-- Social History -->
  <div
    id="section-social-history"
    class="form-section"
    style="margin-top: 30px"
  >
    <label style="font-size: 25px; margin-bottom: 20px; font-weight: 600"
      >Social History (SH)</label
    >
    <div class="boxed-section">
      <div class="form-subsection">
        <label for="sh-smoking">Smoking Status</label>
        <select
          id="sh-smoking"
          style="
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 14px;
          "
        >
          <option value="" disabled selected>Select smoking status</option>
          <option value="never-smoker">Never smoker</option>
          <option value="ex-smoker">Ex-smoker (quit >1 year ago)</option>
          <option value="recent-ex">Recent ex-smoker (quit <1 year ago)</option>
          <option value="light-smoker">Light smoker (1-10 cigs/day)</option>
          <option value="moderate-smoker">
            Moderate smoker (11-20 cigs/day)
          </option>
          <option value="heavy-smoker">Heavy smoker (>20 cigs/day)</option>
          <option value="vaper">E-cigarette/Vape user</option>
          <option value="other-tobacco">Other tobacco products</option>
        </select>
        <!-- Pack-years inputs -->
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
          "
        >
          <div>
            <label for="sh-cigs-per-day" style="font-size: 13px"
              >Cigarettes per day</label
            >
            <input
              type="number"
              id="sh-cigs-per-day"
              min="0"
              max="500"
              step="1"
              inputmode="numeric"
              oninput="if(this.value===''){return;} const v=Number(this.value); if(!Number.isFinite(v)||v<0){this.value=0;} else if(v>500){this.value=500;}"
              style="
                width: 100%;
                box-sizing: border-box;
                padding: 8px;
                font-size: 14px;
              "
            />
          </div>
          <div>
            <label for="sh-years-smoked" style="font-size: 13px"
              >Years smoked</label
            >
            <input
              type="number"
              id="sh-years-smoked"
              min="0"
              max="100"
              step="0.1"
              inputmode="decimal"
              oninput="if(this.value===''){return;} const v=Number(this.value); if(!Number.isFinite(v)||v<0){this.value=0;} else if(v>100){this.value=100;}"
              style="
                width: 100%;
                box-sizing: border-box;
                padding: 8px;
                font-size: 14px;
              "
            />
          </div>
        </div>
      </div>

      <div class="form-subsection">
        <label for="sh-alcohol">Alcohol Consumption</label>
        <select
          id="sh-alcohol"
          style="
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 14px;
          "
        >
          <option value="" disabled selected>Select alcohol consumption</option>
          <option value="none">None/Teetotal</option>
          <option value="social">Social drinker (occasional)</option>
          <option value="moderate">Moderate (within guidelines)</option>
          <option value="heavy">Heavy drinker (exceeds guidelines)</option>
          <option value="binge">Binge drinking pattern</option>
          <option value="recovering">Recovering alcoholic</option>
        </select>
      </div>

      <div class="form-subsection">
        <label for="sh-drugs">Recreational Drug Use</label>
        <select
          id="sh-drugs"
          style="
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 14px;
          "
        >
          <option value="" disabled selected>Select drug use status</option>
          <option value="none">No recreational drug use</option>
          <option value="cannabis">Cannabis use</option>
          <option value="cocaine">Cocaine use</option>
          <option value="opiates">Opiate use</option>
          <option value="stimulants">Stimulant use</option>
          <option value="multiple">Multiple substances</option>
          <option value="recovering">Recovering drug user</option>
          <option value="prefer-not-say">Prefer not to say</option>
        </select>
      </div>

      <div class="form-subsection">
        <label for="sh-occupation">Occupation</label>
        <select
          id="sh-occupation"
          style="
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 14px;
          "
        >
          <option value="" disabled selected>Select occupation</option>
          <option value="unemployed">Unemployed</option>
          <option value="student">Student</option>
          <option value="employed">Employed</option>
          <option value="healthcare">Healthcare worker</option>
          <option value="manual-labor">Manual labor</option>
          <option value="office">Office/Administrative</option>
          <option value="professional">Professional</option>
          <option value="homemaker">Homemaker</option>
          <option value="retired">Retired</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div class="form-subsection">
        <label for="sh-living">Living Situation & Support</label>
        <select
          id="sh-living"
          style="
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 14px;
          "
        >
          <option value="" disabled selected>Select living situation</option>
          <option value="alone">Lives alone</option>
          <option value="with-family">With family/partner</option>
          <option value="with-roommates">With roommates</option>
          <option value="assisted-living">Assisted living</option>
          <option value="care-home">Care/Nursing home</option>
          <option value="homeless">Homeless/Unstable housing</option>
        </select>
      </div>

      <div class="form-subsection">
        <label for="sh-travel">Recent Travel</label>
        <select
          id="sh-travel"
          style="
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 14px;
          "
        >
          <option value="" disabled selected>Select recent travel</option>
          <option value="none">No recent travel</option>
          <option value="domestic-1m">Domestic travel (last 1 month)</option>
          <option value="international-1m">
            International travel (last 1 month)
          </option>
          <option value="international-3m">
            International travel (last 3 months)
          </option>
          <option value="high-risk">Travel to high-risk regions</option>
        </select>
      </div>
    </div>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 20px"
  ></div>

  <!-- CC -->
  <div
    id="section-chief-complaint"
    class="form-section"
    style="margin-top: 36px"
  >
    <label
      for="chief-complaint"
      style="font-size: 25px; margin-bottom: 20px; font-weight: 600"
      >Chief Complaint (CC)</label
    >
    <select
      id="chief-complaint"
      style="
        width: 100%;
        box-sizing: border-box;
        padding: 11px;
        font-size: 14px;
      "
    >
      <optgroup label="Cardiovascular">
        <option value="chest-pain">Chest Pain</option>
        <option value="tearing-chest-pain">Tearing Chest Pain</option>
        <option value="back-pain-cvs">Back Pain (CVS)</option>
        <option value="palpitations">Palpitations</option>
        <option value="syncope">Syncope/Fainting</option>
        <option value="leg-swelling">Leg Swelling</option>
        <option value="claudication">Claudication</option>
      </optgroup>
      <optgroup label="Respiratory">
        <option value="shortness-breath">Shortness of Breath</option>
        <option value="cough">Cough</option>
        <option value="wheeze">Wheeze</option>
        <option value="hemoptysis">Coughing Blood</option>
        <option value="chest-tightness">Chest Tightness</option>
        <option value="chest-pain-respiratory">Chest Pain (non-cardiac)</option>
      </optgroup>
      <optgroup label="Gastrointestinal">
        <option value="abdominal-pain">Abdominal Pain</option>
        <option value="nausea-vomiting">Nausea/Vomiting</option>
        <option value="diarrhea">Diarrhea</option>
        <option value="constipation">Constipation</option>
        <option value="dysphagia">Difficulty Swallowing</option>
        <option value="heartburn">Heartburn/GERD</option>
        <option value="gi-bleeding">GI Bleeding</option>
        <option value="jaundice">Jaundice</option>
      </optgroup>
      <optgroup label="Neurological">
        <option value="headache">Headache</option>
        <option value="dizziness">Dizziness/Vertigo</option>
        <option value="seizure">Seizure</option>
        <option value="weakness">Weakness</option>
        <option value="numbness">Numbness/Tingling</option>
        <option value="memory-loss">Memory Loss</option>
        <option value="confusion">Confusion</option>
        <option value="speech-difficulty">Speech Difficulty</option>
      </optgroup>
      <optgroup label="Musculoskeletal">
        <option value="joint-pain">Joint Pain</option>
        <option value="back-pain">Back Pain</option>
        <option value="neck-pain">Neck Pain</option>
        <option value="muscle-pain">Muscle Pain</option>
        <option value="chest-pain-msk">Chest Pain (musculoskeletal)</option>
        <option value="stiffness">Stiffness</option>
        <option value="swelling">Joint Swelling</option>
      </optgroup>
      <optgroup label="Genitourinary">
        <option value="dysuria">Painful Urination</option>
        <option value="frequency">Urinary Frequency</option>
        <option value="urgency">Urinary Urgency</option>
        <option value="hematuria">Blood in Urine</option>
        <option value="incontinence">Incontinence</option>
        <option value="discharge">Genital Discharge</option>
      </optgroup>
      <optgroup label="Constitutional">
        <option value="fever">Fever</option>
        <option value="fatigue">Fatigue</option>
        <option value="weight-loss">Weight Loss</option>
        <option value="weight-gain">Weight Gain</option>
        <option value="night-sweats">Night Sweats</option>
        <option value="sweating">Sweating</option>
        <option value="appetite-loss">Loss of Appetite</option>
      </optgroup>
      <optgroup label="Dermatological">
        <option value="rash">Rash</option>
        <option value="itching">Itching</option>
        <option value="skin-lesions">Skin Lesions</option>
        <option value="hair-loss">Hair Loss</option>
      </optgroup>
      <optgroup label="ENT">
        <option value="sore-throat">Sore Throat</option>
        <option value="hearing-loss">Hearing Loss</option>
        <option value="tinnitus">Tinnitus</option>
        <option value="vision-changes">Vision Changes</option>
        <option value="eye-pain">Eye Pain</option>
        <option value="nasal-congestion">Nasal Congestion</option>
      </optgroup>
      <optgroup label="Ophthalmology">
        <option value="red-eye">Red Eye</option>
        <option value="eye-discharge">Eye Discharge</option>
        <option value="vision-loss">Acute Vision Loss</option>
        <option value="photophobia">Photophobia</option>
        <option value="floaters">Floaters/Flashes</option>
      </optgroup>
      <optgroup label="Obstetric/Gynecologic">
        <option value="amenorrhea">Amenorrhea</option>
        <option value="vaginal-bleeding">Vaginal Bleeding</option>
        <option value="pelvic-pain">Pelvic Pain</option>
        <option value="dyspareunia">Dyspareunia</option>
        <option value="pregnancy-concerns">Pregnancy-related Concerns</option>
        <option value="vaginal-discharge">Vaginal Discharge</option>
      </optgroup>
      <optgroup label="Endocrine">
        <option value="polyuria-polydipsia">Polyuria/Polydipsia</option>
        <option value="heat-cold-intolerance">Heat/Cold Intolerance</option>
        <option value="hair-skin-changes">Hair/Skin Changes</option>
      </optgroup>
      <optgroup label="Hematologic/Oncology">
        <option value="easy-bruising">Easy Bruising/Bleeding</option>
        <option value="lymphadenopathy">Lymph Node Swelling</option>
        <option value="unexplained-fever">Unexplained Fever</option>
      </optgroup>
      <optgroup label="Renal/Urologic">
        <option value="flank-pain">Flank Pain</option>
        <option value="edema">Edema</option>
        <option value="urinary-retention">Urinary Retention</option>
      </optgroup>
      <optgroup label="Infectious Disease">
        <option value="sore-lesion">Skin/Soft Tissue Infection</option>
        <option value="exposure-risk">Exposure/Needlestick</option>
        <option value="travel-illness">Fever after Travel</option>
      </optgroup>
      <optgroup label="Dental/Oral">
        <option value="tooth-pain">Tooth Pain</option>
        <option value="oral-ulcers">Oral Ulcers</option>
        <option value="jaw-swelling">Jaw Swelling</option>
      </optgroup>
      <optgroup label="Psychiatric">
        <option value="depression">Depression</option>
        <option value="anxiety">Anxiety</option>
        <option value="sleep-disturbance">Sleep Disturbance</option>
        <option value="mood-changes">Mood Changes</option>
      </optgroup>
      <option value="other">Other</option>
    </select>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 30px"
  ></div>

  <!-- SOCRATES Expanded -->
  <div id="section-socrates" class="form-section" style="margin-top: 35px">
    <label style="font-size: 25px; margin-bottom: 28px; font-weight: 600"
      >SOCRATES</label
    >
    <div id="socrates-wrapper">
      <div class="form-subsection">
        <label for="site">Site</label>
        <select id="site" style="width: 100%; padding: 8px; font-size: 14px">
          <optgroup label="Head & Neck">
            <option value="head-frontal">Head - Frontal</option>
            <option value="head-temporal">Head - Temporal</option>
            <option value="head-occipital">Head - Occipital</option>
            <option value="head-parietal">Head - Parietal</option>
            <option value="head-all">Head - All around</option>
            <option value="face">Face</option>
            <option value="jaw">Jaw</option>
            <option value="neck-anterior">Neck - Anterior</option>
            <option value="neck-posterior">Neck - Posterior</option>
            <option value="throat">Throat</option>
            <option value="ear">Ear</option>
            <option value="eye">Eye</option>
            <option value="sinus">Sinus</option>
          </optgroup>
          <optgroup label="Chest">
            <option value="chest-central">Chest - Central/Retrosternal</option>
            <option value="chest-left">Chest - Left sided</option>
            <option value="chest-right">Chest - Right sided</option>
            <option value="chest-upper">Chest - Upper</option>
            <option value="chest-lower">Chest - Lower</option>
            <option value="chest-back">Chest - Back</option>
            <option value="precordial">Precordial</option>
            <option value="intercostal">Intercostal</option>
          </optgroup>
          <optgroup label="Abdomen">
            <option value="epigastric">Epigastric</option>
            <option value="ruq">Right Upper Quadrant</option>
            <option value="luq">Left Upper Quadrant</option>
            <option value="rlq">Right Lower Quadrant</option>
            <option value="llq">Left Lower Quadrant</option>
            <option value="periumbilical">Periumbilical</option>
            <option value="suprapubic">Suprapubic</option>
            <option value="hypochondrium-right">Right Hypochondrium</option>
            <option value="hypochondrium-left">Left Hypochondrium</option>
            <option value="lumbar-right">Right Lumbar</option>
            <option value="lumbar-left">Left Lumbar</option>
            <option value="iliac-right">Right Iliac</option>
            <option value="iliac-left">Left Iliac</option>
          </optgroup>
          <optgroup label="Back">
            <option value="cervical">Neck/Cervical</option>
            <option value="back-upper">Upper Back/Thoracic</option>
            <option value="back-mid">Mid Back</option>
            <option value="back-lower">Lower Back/Lumbar</option>
            <option value="sacral">Sacral</option>
            <option value="coccyx">Coccyx</option>
            <option value="flank-left">Left Flank</option>
            <option value="flank-right">Right Flank</option>
          </optgroup>
          <optgroup label="Extremities">
            <option value="shoulder-left">Left Shoulder</option>
            <option value="shoulder-right">Right Shoulder</option>
            <option value="arm-left">Left Arm</option>
            <option value="arm-right">Right Arm</option>
            <option value="elbow-left">Left Elbow</option>
            <option value="elbow-right">Right Elbow</option>
            <option value="wrist-left">Left Wrist</option>
            <option value="wrist-right">Right Wrist</option>
            <option value="hand-left">Left Hand</option>
            <option value="hand-right">Right Hand</option>
            <option value="finger-left">Left Finger(s)/Thumb</option>
            <option value="finger-right">Right Finger(s)/Thumb</option>
            <option value="hip-left">Left Hip</option>
            <option value="hip-right">Right Hip</option>
            <option value="leg-left">Left Leg</option>
            <option value="leg-right">Right Leg</option>
            <option value="knee-left">Left Knee</option>
            <option value="knee-right">Right Knee</option>
            <option value="ankle-left">Left Ankle</option>
            <option value="ankle-right">Right Ankle</option>
            <option value="foot-left">Left Foot</option>
            <option value="foot-right">Right Foot</option>
            <option value="toe-left">Left Toe(s)/Great Toe</option>
            <option value="toe-right">Right Toe(s)/Great Toe</option>
          </optgroup>
          <optgroup label="Pelvis & Genitalia">
            <option value="pelvis">Pelvis</option>
            <option value="groin-left">Left Groin</option>
            <option value="groin-right">Right Groin</option>
            <option value="genitalia">Genitalia</option>
            <option value="perineum">Perineum</option>
          </optgroup>
          <optgroup label="Body">
            <option value="generalized">Generalized</option>
            <option value="multiple-sites">Multiple Sites</option>
          </optgroup>
        </select>
      </div>
      <div class="form-subsection">
        <label for="onset">Onset</label>
        <select id="onset" style="width: 100%; padding: 8px; font-size: 14px">
          <option value="sudden">Sudden (seconds to minutes)</option>
          <option value="acute">Acute (hours to days)</option>
          <option value="subacute">Subacute (days to weeks)</option>
          <option value="chronic">Chronic (weeks to months)</option>
          <option value="gradual">Gradual progression</option>
        </select>
      </div>
      <div class="form-subsection">
        <label for="character">Character</label>
        <select
          id="character"
          style="width: 100%; padding: 8px; font-size: 14px"
        >
          <option value="sharp">Sharp/Stabbing</option>
          <option value="dull">Dull/Aching</option>
          <option value="burning">Burning</option>
          <option value="crushing">Crushing/Pressure</option>
          <option value="tearing">Tearing/Ripping</option>
          <option value="cramping">Cramping</option>
          <option value="throbbing">Throbbing/Pulsating</option>
          <option value="shooting">Shooting</option>
          <option value="gnawing">Gnawing</option>
          <option value="tight">Tight/Constricting</option>
        </select>
      </div>
      <div class="form-subsection">
        <label for="radiation">Radiation</label>
        <select
          id="radiation"
          style="width: 100%; padding: 8px; font-size: 14px"
        >
          <option value="none">No radiation</option>
          <option value="left-arm">Left arm</option>
          <option value="right-arm">Right arm</option>
          <option value="both-arms">Both arms</option>
          <option value="jaw">Jaw</option>
          <option value="neck">Neck</option>
          <option value="back">Back</option>
          <option value="shoulder">Shoulder</option>
          <option value="down-leg">Down leg(s)</option>
          <option value="groin">Groin</option>
        </select>
      </div>
      <div class="form-subsection">
        <label for="associated">Associated Symptoms</label>
        <select
          id="associated"
          name="associated"
          style="width: 100%; padding: 8px; font-size: 14px; margin-top: 5px"
        >
          <optgroup label="General/Constitutional">
            <option value="fever">Fever</option>
            <option value="chills">Chills</option>
            <option value="night-sweats">Night sweats</option>
            <option value="sweating">Sweating</option>
            <option value="excessive-sweating">Excessive sweating</option>
            <option value="fatigue">Fatigue</option>
            <option value="weight-loss">Unintentional weight loss</option>
            <option value="weight-gain">Weight gain</option>
            <option value="appetite-loss">Loss of appetite</option>
          </optgroup>
          <optgroup label="Cardiovascular">
            <option value="palpitations">Palpitations</option>
            <option value="orthopnea">Orthopnea</option>
            <option value="pnd">Paroxysmal nocturnal dyspnea</option>
            <option value="leg-swelling">Leg swelling</option>
            <option value="syncope">Syncope/Fainting</option>
            <option value="chest-tightness">Chest tightness</option>
            <option value="nausea-cvs">Nausea</option>
            <option value="vomiting-cvs">Vomiting</option>
          </optgroup>
          <optgroup label="Respiratory">
            <option value="shortness-breath">Shortness of breath</option>
            <option value="cough">Cough</option>
            <option value="sputum">Sputum</option>
            <option value="wheeze">Wheeze</option>
            <option value="hemoptysis">Coughing blood</option>
            <option value="pleuritic-pain">Pleuritic chest pain</option>
          </optgroup>
          <optgroup label="Gastrointestinal">
            <option value="nausea">Nausea</option>
            <option value="vomiting">Vomiting</option>
            <option value="diarrhea">Diarrhea</option>
            <option value="constipation">Constipation</option>
            <option value="abdominal-bloating">Abdominal bloating</option>
            <option value="heartburn">Heartburn/Acid reflux</option>
            <option value="dysphagia">Difficulty swallowing</option>
            <option value="melena">Black stools (melena)</option>
            <option value="hematochezia">Blood per rectum</option>
          </optgroup>
          <optgroup label="Genitourinary">
            <option value="dysuria">Painful urination</option>
            <option value="frequency">Frequency</option>
            <option value="urgency">Urgency</option>
            <option value="nocturia">Nocturia</option>
            <option value="hematuria">Blood in urine</option>
            <option value="incontinence">Incontinence</option>
            <option value="discharge">Genital discharge</option>
          </optgroup>
          <optgroup label="Neurological">
            <option value="headache">Headache</option>
            <option value="dizziness">Dizziness/Vertigo</option>
            <option value="weakness">Weakness</option>
            <option value="numbness">Numbness/Tingling</option>
            <option value="vision-changes">Vision changes</option>
            <option value="speech-difficulty">Speech difficulty</option>
            <option value="seizure">Seizures</option>
            <option value="confusion">Confusion</option>
            <option value="memory-loss">Memory loss</option>
          </optgroup>
          <optgroup label="Musculoskeletal">
            <option value="joint-pain">Joint pain</option>
            <option value="joint-swelling">Joint swelling</option>
            <option value="stiffness">Stiffness</option>
            <option value="muscle-pain">Muscle pain</option>
            <option value="back-pain">Back pain</option>
          </optgroup>
          <optgroup label="Endocrine/Metabolic">
            <option value="heat-intolerance">Heat intolerance</option>
            <option value="cold-intolerance">Cold intolerance</option>
            <option value="polyuria">Polyuria</option>
            <option value="polydipsia">Polydipsia</option>
            <option value="polyphagia">Polyphagia</option>
          </optgroup>
          <optgroup label="Dermatological">
            <option value="rash">Rash</option>
            <option value="itching">Itching</option>
            <option value="skin-lesions">Skin lesions</option>
            <option value="hair-loss">Hair loss</option>
          </optgroup>
          <optgroup label="ENT">
            <option value="sore-throat">Sore throat</option>
            <option value="runny-nose">Runny nose</option>
            <option value="nasal-congestion">Nasal congestion</option>
            <option value="ear-pain">Ear pain</option>
            <option value="tinnitus">Tinnitus</option>
            <option value="hearing-loss">Hearing loss</option>
          </optgroup>
          <optgroup label="Psychiatric">
            <option value="anxiety">Anxiety</option>
            <option value="depression">Depression</option>
            <option value="insomnia">Insomnia</option>
            <option value="irritability">Irritability</option>
            <option value="hallucinations">Hallucinations</option>
          </optgroup>
        </select>
      </div>
      <div class="form-subsection">
        <label for="timing">Timing</label>
        <select id="timing" style="width: 100%; padding: 8px; font-size: 14px">
          <option value="constant">Constant</option>
          <option value="intermittent">Intermittent</option>
          <option value="episodic">Episodic</option>
          <option value="morning">Worse in morning</option>
          <option value="evening">Worse in evening</option>
          <option value="night">Worse at night</option>
          <option value="activity">Related to activity</option>
          <option value="meals">Related to meals</option>
          <option value="stress">Related to stress</option>
        </select>
      </div>
      <div class="form-subsection">
        <label for="exacerbating">Exacerbating Factors</label>
        <select
          id="exacerbating"
          style="width: 100%; padding: 8px; font-size: 14px; margin-top: 5px"
        >
          <option value="movement">Movement</option>
          <option value="exercise">Exercise</option>
          <option value="deep-breathing">Deep breathing</option>
          <option value="coughing">Coughing</option>
          <option value="eating">Eating</option>
          <option value="stress">Stress</option>
          <option value="on-its-own">On its own</option>
          <option value="none">None</option>
          <option value="unknown">Unknown</option>
        </select>
      </div>
      <div class="form-subsection">
        <label for="relieving">Relieving Factors</label>
        <select
          id="relieving"
          style="width: 100%; padding: 8px; font-size: 14px; margin-top: 5px"
        >
          <option value="rest">Rest</option>
          <option value="medication">Medication</option>
          <option value="position-change">Position change</option>
          <option value="heat">Heat application</option>
          <option value="cold">Cold application</option>
          <option value="nothing">Nothing helps</option>
          <option value="none">None</option>
          <option value="unknown">Unknown</option>
        </select>
      </div>
      <div class="form-subsection">
        <label for="severity">Severity (0–10)</label
        ><select id="severity">
          <option value="unknown">Unknown</option>
          <option value="0">0 – No pain</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 – Moderate</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10 – Worst imaginable</option>
        </select>
      </div>
    </div>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 15px"
  ></div>

  <!-- PMH / PSH -->
  <div id="section-past-medical" class="form-section" style="margin-top: 27px">
    <label
      for="past-medical"
      style="font-size: 25px; margin-bottom: 20px; font-weight: 600"
      >Past Medical History (PMH)</label
    >
    <select
      id="past-medical"
      multiple
      size="12"
      data-dropdown-checkbox
      style="width: 100%; padding: 8px; font-size: 14px"
    >
      <optgroup label="Cardiovascular">
        <option value="Hypertension">Hypertension</option>
        <option value="Ischemic heart disease">
          Ischemic heart disease/MI
        </option>
        <option value="Heart failure">Heart failure</option>
        <option value="Atrial fibrillation">Atrial fibrillation</option>
        <option value="Valve disease">Valvular heart disease</option>
        <option value="Peripheral arterial disease">
          Peripheral arterial disease
        </option>
        <option value="Dyslipidemia">Dyslipidemia</option>
      </optgroup>
      <optgroup label="Endocrine/Metabolic">
        <option value="Diabetes mellitus Type 1">
          Diabetes mellitus Type 1
        </option>
        <option value="Diabetes mellitus Type 2">
          Diabetes mellitus Type 2
        </option>
        <option value="Hypothyroidism">Hypothyroidism</option>
        <option value="Hyperthyroidism">Hyperthyroidism</option>
        <option value="Obesity">Obesity</option>
      </optgroup>
      <optgroup label="Respiratory">
        <option value="Asthma">Asthma</option>
        <option value="COPD">COPD</option>
        <option value="Pulmonary embolism">Pulmonary embolism</option>
      </optgroup>
      <optgroup label="Renal/Urologic">
        <option value="CKD">Chronic kidney disease</option>
        <option value="Nephrolithiasis">Kidney stones</option>
      </optgroup>
      <optgroup label="Hepatic/GI">
        <option value="Chronic liver disease">Chronic liver disease</option>
        <option value="Peptic ulcer">Peptic ulcer disease</option>
        <option value="IBD">Inflammatory bowel disease</option>
      </optgroup>
      <optgroup label="Neurology">
        <option value="Stroke/TIA">Stroke/TIA</option>
        <option value="Epilepsy">Epilepsy</option>
        <option value="Parkinson's">Parkinson's disease</option>
      </optgroup>
      <optgroup label="Rheumatology/Autoimmune">
        <option value="Rheumatoid arthritis">Rheumatoid arthritis</option>
        <option value="SLE">SLE</option>
        <option value="Gout">Gout</option>
        <option value="Autoimmune disease">Other autoimmune disease</option>
      </optgroup>
      <optgroup label="Infectious">
        <option value="TB">Tuberculosis</option>
        <option value="HIV">HIV</option>
        <option value="Hepatitis B/C">Hepatitis B/C</option>
      </optgroup>
      <optgroup label="Oncology/Hematology">
        <option value="Cancer">Cancer</option>
        <option value="Anemia">Chronic anemia</option>
        <option value="Clotting disorder">Clotting disorder</option>
      </optgroup>
      <optgroup label="Psychiatric">
        <option value="Depression">Depression</option>
        <option value="Anxiety">Anxiety</option>
        <option value="Bipolar">Bipolar disorder</option>
      </optgroup>
      <optgroup label="Other">
        <option value="Pregnancy">Pregnancy</option>
        <option value="None">None</option>
        <option value="Unknown">Unknown</option>
      </optgroup>
    </select>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 20px"
  ></div>

  <div id="section-past-surgical" class="form-section" style="margin-top: 30px">
    <label
      for="past-surgical"
      style="font-size: 25px; margin-bottom: 20px; font-weight: 600"
      >Past Surgical History (PSH)</label
    >
    <select
      id="past-surgical"
      multiple
      size="10"
      data-dropdown-checkbox
      style="width: 100%; padding: 8px; font-size: 14px"
    >
      <optgroup label="General Surgery">
        <option value="Appendectomy">Appendectomy</option>
        <option value="Cholecystectomy">Cholecystectomy</option>
        <option value="Hernia repair">Hernia repair</option>
        <option value="Bowel resection">Bowel resection</option>
      </optgroup>
      <optgroup label="Cardiothoracic">
        <option value="CABG/PCI">CABG/PCI</option>
        <option value="Valve surgery">Valve surgery</option>
        <option value="Thoracic surgery">Thoracic surgery</option>
      </optgroup>
      <optgroup label="Orthopedic">
        <option value="Joint replacement">Joint replacement</option>
        <option value="Fracture fixation">Fracture fixation</option>
        <option value="Spine surgery">Spine surgery</option>
      </optgroup>
      <optgroup label="OB/Gyn">
        <option value="C-section">Cesarean section</option>
        <option value="Hysterectomy">Hysterectomy</option>
        <option value="Oophorectomy">Oophorectomy</option>
      </optgroup>
      <optgroup label="ENT">
        <option value="Tonsillectomy">Tonsillectomy</option>
        <option value="Thyroidectomy">Thyroidectomy</option>
      </optgroup>
      <optgroup label="Urology">
        <option value="TURP">TURP</option>
        <option value="Nephrectomy">Nephrectomy</option>
      </optgroup>
      <optgroup label="Other">
        <option value="None">None</option>
        <option value="Unknown">Unknown</option>
      </optgroup>
    </select>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 20px"
  ></div>

  <!-- Drug History Expanded -->
  <div id="section-drug-history" class="form-section" style="margin-top: 30px">
    <label style="font-size: 25px; margin-bottom: 20px; font-weight: 600"
      >Drug History (DH)</label
    >
    <div class="boxed-section">
      <div class="form-subsection">
        <label for="regular-meds">Regular Medications</label>
        <select
          id="regular-meds"
          multiple
          size="14"
          data-dropdown-checkbox
          style="width: 100%; padding: 8px; font-size: 14px"
        >
          <optgroup label="Cardiovascular: Antihypertensives">
            <option value="ACE inhibitor">
              ACE inhibitors (e.g., enalapril, lisinopril)
            </option>
            <option value="ARB">ARBs (e.g., losartan, valsartan)</option>
            <option value="Beta-blocker">
              Beta-blockers (e.g., metoprolol, atenolol)
            </option>
            <option value="CCB">
              Calcium channel blockers (e.g., amlodipine, diltiazem)
            </option>
            <option value="Thiazide diuretic">
              Thiazide diuretics (e.g., HCTZ, chlorthalidone)
            </option>
            <option value="Loop diuretic">
              Loop diuretics (e.g., furosemide, bumetanide)
            </option>
            <option value="Aldosterone antagonist">
              Aldosterone antagonists (e.g., spironolactone, eplerenone)
            </option>
          </optgroup>
          <optgroup label="Cardiovascular: Lipids/Platelets/Anticoag">
            <option value="Statin">
              Statins (e.g., atorvastatin, rosuvastatin)
            </option>
            <option value="Ezetimibe">Ezetimibe</option>
            <option value="PCSK9 inhibitor">PCSK9 inhibitors</option>
            <option value="Antiplatelet">
              Antiplatelets (aspirin, clopidogrel)
            </option>
            <option value="Warfarin">Warfarin</option>
            <option value="DOAC">
              DOACs (apixaban, rivaroxaban, dabigatran)
            </option>
          </optgroup>
          <optgroup label="Cardiovascular: Antiarrhythmics">
            <option value="Amiodarone">Amiodarone</option>
            <option value="Flecainide">Flecainide/Propafenone</option>
            <option value="Sotalol">Sotalol</option>
          </optgroup>
          <optgroup label="Diabetes">
            <option value="Metformin">Metformin</option>
            <option value="Sulfonylurea">
              Sulfonylureas (e.g., gliclazide)
            </option>
            <option value="DPP-4 inhibitor">
              DPP-4 inhibitors (e.g., sitagliptin)
            </option>
            <option value="GLP-1 RA">
              GLP-1 receptor agonists (e.g., semaglutide)
            </option>
            <option value="SGLT2 inhibitor">
              SGLT2 inhibitors (e.g., empagliflozin)
            </option>
            <option value="Insulin">Insulin (basal/bolus/mixed)</option>
          </optgroup>
          <optgroup label="Respiratory">
            <option value="SABA">
              SABA inhalers (e.g., salbutamol/albuterol)
            </option>
            <option value="LABA">
              LABA inhalers (e.g., salmeterol, formoterol)
            </option>
            <option value="ICS">Inhaled corticosteroids</option>
            <option value="LAMA">LAMA (e.g., tiotropium)</option>
            <option value="Leukotriene antagonist">
              Leukotriene antagonists (montelukast)
            </option>
          </optgroup>
          <optgroup label="Gastrointestinal">
            <option value="PPI">
              Proton pump inhibitors (omeprazole, pantoprazole)
            </option>
            <option value="H2RA">H2 blockers (ranitidine/famotidine)</option>
            <option value="Antiemetic">
              Antiemetics (ondansetron, metoclopramide)
            </option>
            <option value="Laxative">Laxatives (senna, lactulose, PEG)</option>
            <option value="Antispasmodic">
              Antispasmodics (hyoscine/mebeverine)
            </option>
          </optgroup>
          <optgroup label="Pain/Neuro">
            <option value="Paracetamol">Paracetamol/Acetaminophen</option>
            <option value="NSAIDs">
              NSAIDs (ibuprofen, naproxen, diclofenac)
            </option>
            <option value="Opioids">
              Opioids (morphine, oxycodone, tramadol)
            </option>
            <option value="Antidepressants">
              Antidepressants (SSRIs/SNRIs/TCAs)
            </option>
            <option value="Antiepileptics">
              Antiepileptics (valproate, levetiracetam)
            </option>
            <option value="Antipsychotics">
              Antipsychotics (quetiapine, risperidone)
            </option>
            <option value="Benzodiazepines">
              Benzodiazepines (diazepam, lorazepam)
            </option>
          </optgroup>
          <optgroup label="Endocrine/Bone">
            <option value="Thyroxine">Thyroxine (levothyroxine)</option>
            <option value="Steroids">
              Systemic corticosteroids (prednisone)
            </option>
            <option value="Bisphosphonate">
              Bisphosphonates (alendronate)
            </option>
            <option value="Calcium/Vit D">Calcium/Vitamin D</option>
          </optgroup>
          <optgroup label="Anti-infectives: Antibiotics">
            <option value="Penicillins">
              Penicillins (amoxicillin, flucloxacillin)
            </option>
            <option value="Cephalosporins">
              Cephalosporins (cefalexin, ceftriaxone)
            </option>
            <option value="Macrolides">
              Macrolides (azithromycin, clarithromycin)
            </option>
            <option value="Fluoroquinolones">
              Fluoroquinolones (ciprofloxacin, levofloxacin)
            </option>
            <option value="Tetracyclines">Tetracyclines (doxycycline)</option>
            <option value="Sulfonamides">
              Sulfonamides (co-trimoxazole/TMP-SMX)
            </option>
            <option value="Glycopeptides">Glycopeptides (vancomycin)</option>
            <option value="Aminoglycosides">
              Aminoglycosides (gentamicin)
            </option>
            <option value="Nitroimidazoles">
              Nitroimidazoles (metronidazole)
            </option>
            <option value="Nitrofurantoin">Nitrofurantoin</option>
            <option value="Antituberculars">
              Antituberculars (isoniazid, rifampicin)
            </option>
          </optgroup>
          <optgroup label="Anti-infectives: Others">
            <option value="Antifungals">
              Antifungals (fluconazole, nystatin)
            </option>
            <option value="Antivirals">
              Antivirals (acyclovir, oseltamivir)
            </option>
            <option value="Antiparasitics">Antiparasitics (albendazole)</option>
          </optgroup>
          <optgroup label="Other">
            <option value="None">None</option>
            <option value="Unknown">Unknown</option>
          </optgroup>
        </select>
      </div>
      <div class="form-subsection">
        <label for="otc">OTC / Herbal / Supplements</label>
        <select
          id="otc"
          multiple
          size="10"
          data-dropdown-checkbox
          style="width: 100%; padding: 8px; font-size: 14px"
        >
          <optgroup label="Analgesics/Antipyretics">
            <option value="Paracetamol">Paracetamol/Acetaminophen</option>
            <option value="NSAIDs">NSAIDs (ibuprofen, naproxen)</option>
            <option value="Topical analgesics">
              Topical analgesics (diclofenac gel)
            </option>
          </optgroup>
          <optgroup label="Gastrointestinal">
            <option value="Antacids">Antacids</option>
            <option value="Laxatives">Laxatives (senna, PEG)</option>
            <option value="Antidiarrheals">Antidiarrheals (loperamide)</option>
          </optgroup>
          <optgroup label="Respiratory/Cold">
            <option value="Decongestants">Decongestants</option>
            <option value="Antihistamines">Antihistamines</option>
            <option value="Cough remedies">Cough remedies</option>
          </optgroup>
          <optgroup label="Vitamins/Supplements">
            <option value="Vitamin D">Vitamin D</option>
            <option value="Vitamin B12">Vitamin B12</option>
            <option value="Multivitamin">Multivitamins</option>
            <option value="Iron">Iron</option>
            <option value="Calcium">Calcium</option>
            <option value="Omega-3">Omega-3</option>
          </optgroup>
          <optgroup label="Herbal/Alternative">
            <option value="Herbal">Herbal remedies</option>
          </optgroup>
          <optgroup label="Other">
            <option value="None">None</option>
            <option value="Unknown">Unknown</option>
          </optgroup>
        </select>
      </div>
      <div class="form-subsection">
        <label for="drug-allergies">Drug Allergies</label>
        <select
          id="drug-allergies"
          multiple
          size="10"
          data-dropdown-checkbox
          style="width: 100%; padding: 8px; font-size: 14px"
        >
          <optgroup label="General">
            <option value="NKDA">No known drug allergies (NKDA)</option>
          </optgroup>
          <optgroup label="Antibiotics">
            <option value="Penicillins">Penicillins</option>
            <option value="Cephalosporins">Cephalosporins</option>
            <option value="Macrolides">Macrolides</option>
            <option value="Fluoroquinolones">Fluoroquinolones</option>
            <option value="Tetracyclines">Tetracyclines</option>
            <option value="Sulfonamides">Sulfonamides (TMP-SMX)</option>
            <option value="Glycopeptides">Glycopeptides (vancomycin)</option>
            <option value="Aminoglycosides">Aminoglycosides</option>
            <option value="Nitroimidazoles">
              Nitroimidazoles (metronidazole)
            </option>
          </optgroup>
          <optgroup label="Analgesics">
            <option value="NSAIDs">NSAIDs</option>
            <option value="Opioids">Opioids</option>
            <option value="Paracetamol">Paracetamol</option>
          </optgroup>
          <optgroup label="Other">
            <option value="Contrast">Iodinated contrast</option>
            <option value="Latex">Latex</option>
            <option value="Local anesthetics">Local anesthetics</option>
            <option value="Other">Other</option>
          </optgroup>
        </select>
      </div>
    </div>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 20px"
  ></div>

  <!-- Family -->
  <div
    id="section-family-history"
    class="form-section"
    style="margin-top: 30px"
  >
    <label
      for="family-history"
      style="font-size: 25px; margin-bottom: 20px; font-weight: 600"
      >Family History (FH)</label
    >
    <textarea
      id="family-history"
      style="width: 100%; box-sizing: border-box; padding: 8px; font-size: 14px"
    ></textarea>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 10px"
  ></div>

  <label
    style="
      font-size: 25px;
      margin-bottom: -15px;
      font-weight: 600;
      margin-top: 30px;
    "
    >ROS (Review of Systems)</label
  >
  <div
    id="section-review-systems"
    style="
      border: 1px solid var(--all-text);
      border-radius: 10px;
      padding: 10px;
      display: inline-block;
      width: 100%;
      margin-top: 40px;
    "
  >
    <style>
      .pe-switch {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .pe-checkbox {
        width: 18px;
        height: 18px;
        border: 2px solid var(--all-text);
        border-radius: 3px;
        background-color: transparent;
        cursor: pointer;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        transition: all 0.2s ease;
      }

      .pe-checkbox:checked {
        background-color: lightblue !important;
      }
    </style>
    <table
      style="
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 0px;
        border: 1px solid var(--all-text);
        background: transparent;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px); /* for Safari */
        border-radius: 12px;
      "
    >
      <thead>
        <tr>
          <th
            style="
              text-align: left;
              padding: 8px;
              border-bottom: 1px solid var(--all-text);
            "
          >
            System
          </th>
          <th
            style="
              text-align: left;
              padding: 8px;
              border-bottom: 1px solid var(--all-text);
            "
          >
            Symptoms
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            General
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="General"
                value="Weight loss"
              />
              Weight loss</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="General"
                value="Fatigue"
              />
              Fatigue</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="General"
                value="Fever"
              />
              Fever</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="General"
                value="Night sweats"
              />
              Night sweats</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="General"
                value="Sweating"
              />
              Sweating</label
            >
          </td>
        </tr>

        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            Cardiovascular
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CV"
                value="Chest pain"
              />
              Chest pain</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CV"
                value="Palpitations"
              />
              Palpitations</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CV"
                value="Orthopnoea"
              />
              Orthopnoea</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CV"
                value="PND"
              />
              PND</label
            >
          </td>
        </tr>

        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            Respiratory
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Resp"
                value="Cough"
              />
              Cough</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Resp"
                value="Sputum"
              />
              Sputum</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Resp"
                value="Haemoptysis"
              />
              Haemoptysis</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Resp"
                value="Dyspnoea"
              />
              Dyspnoea</label
            >
          </td>
        </tr>

        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            Gastrointestinal
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GI"
                value="Nausea"
              />
              Nausea</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GI"
                value="Vomiting"
              />
              Vomiting</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GI"
                value="Diarrhea"
              />
              Diarrhea</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GI"
                value="Constipation"
              />
              Constipation</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GI"
                value="Bleeding"
              />
              Bleeding</label
            >
          </td>
        </tr>

        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            Genitourinary
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GU"
                value="Dysuria"
              />
              Dysuria</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GU"
                value="Nocturia"
              />
              Nocturia</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GU"
                value="Haematuria"
              />
              Haematuria</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GU"
                value="Incontinence"
              />
              Incontinence</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="GU"
                value="Discharge"
              />
              Discharge</label
            >
          </td>
        </tr>

        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            CNS
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CNS"
                value="Headache"
              />
              Headache</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CNS"
                value="Weakness"
              />
              Weakness</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CNS"
                value="Numbness"
              />
              Numbness</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CNS"
                value="Seizures"
              />
              Seizures</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CNS"
                value="Memory loss"
              />
              Memory loss</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="CNS"
                value="Lightheadedness/syncope"
              />
              Lightheadedness/syncope</label
            >
          </td>
        </tr>

        <tr>
          <td
            style="
              vertical-align: top;
              padding: 8px;
              font-weight: bold;
              border-bottom: 1px solid var(--all-text);
            "
          >
            MSK
          </td>
          <td style="padding: 8px; border-bottom: 1px solid var(--all-text)">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="MSK"
                value="Joint pain"
              />
              Joint pain</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="MSK"
                value="Stiffness"
              />
              Stiffness</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="MSK"
                value="Swelling"
              />
              Swelling</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="MSK"
                value="Back pain"
              />
              Back pain</label
            >
          </td>
        </tr>

        <tr>
          <td style="vertical-align: top; padding: 8px; font-weight: bold">
            Endocrine
          </td>
          <td style="padding: 8px">
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Endocrine"
                value="Heat intolerance"
              />
              Heat intolerance</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Endocrine"
                value="Cold intolerance"
              />
              Cold intolerance</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Endocrine"
                value="Polyuria"
              />
              Polyuria</label
            >
            <label
              ><input
                type="checkbox"
                class="ros"
                data-system="Endocrine"
                value="Polydipsia"
              />
              Polydipsia</label
            >
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 30px"
  ></div>

  <!-- ICE -->
  <div id="section-ice" class="form-section" style="margin-top: 20px">
    <label
      for="ice"
      style="
        font-size: 25px;
        margin-bottom: 10px;
        font-weight: 600;
        margin-top: 26px;
      "
      >ICE (Ideas, Concerns, Expectations)</label
    >
    <textarea
      id="ice"
      style="width: 100%; box-sizing: border-box; padding: 8px; font-size: 14px"
    ></textarea>
  </div>

  <div
    style="border-bottom: 1px solid var(--all-text); padding-bottom: 10px"
  ></div>

  <!-- Physical Examination (PE) -->
  <div id="section-pe" class="form-section" style="margin-top: 35px">
    <div
      style="display: flex; align-items: center; margin-bottom: 20px; gap: 15px"
    >
      <label style="font-size: 25px; font-weight: 600; margin: 0"
        >Physical Examination (PE)
        <span style="font-size: 12px; color: var(--all-text)"
          >(To activate or deactivate the PE, press on the checkbox here)</span
        ></label
      >
      <div
        class="pe-toggle-container"
        style="display: flex; align-items: center; gap: 10px"
      >
        <label class="pe-switch">
          <input
            type="checkbox"
            id="pe-toggle"
            class="pe-checkbox"
            onclick="togglePESection()"
          />
        </label>
      </div>
    </div>

    <div
      id="pe-content"
      style="display: none; opacity: 0; transition: all 0.5s ease"
    >
      <div id="pe-wrapper">
        <!-- General Appearance -->
        <div class="form-subsection">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>General Appearance</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search general appearance..."
              class="pe-search"
              data-target="pe-general"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-general"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 80px;
              "
            >
              <option value="well-appearing">
                Well-appearing, no acute distress
              </option>
              <option value="mild-distress">Mild distress</option>
              <option value="moderate-distress">Moderate distress</option>
              <option value="severe-distress">Severe distress</option>
              <option value="toxic-appearing">Toxic appearing</option>
              <option value="cachetic">Cachetic/Wasted</option>
              <option value="obese">Obese</option>
              <option value="anxious">Anxious/Agitated</option>
              <option value="lethargic">Lethargic/Drowsy</option>
              <option value="confused">Confused/Disoriented</option>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-general-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-general-others', 'pe-general-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-general-others-text"
                placeholder="Describe other general appearance findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Hands -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Hands</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search hand findings..."
              class="pe-search"
              data-target="pe-hands"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-hands"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="General">
                <option value="hands-normal">Normal hands and fingers</option>
                <option value="hands-warm">Warm hands</option>
                <option value="hands-cold">Cold hands</option>
                <option value="hands-clammy">Clammy hands</option>
                <option value="hands-dry">Dry hands</option>
              </optgroup>
              <optgroup label="Nails">
                <option value="nails-normal">Normal nail beds</option>
                <option value="clubbing">Digital clubbing</option>
                <option value="nail-cyanosis">Nail bed cyanosis</option>
                <option value="nail-pallor">Nail bed pallor</option>
                <option value="splinter-hemorrhages">
                  Splinter hemorrhages
                </option>
                <option value="koilonychia">Koilonychia (spoon nails)</option>
              </optgroup>
              <optgroup label="Joints/Movement">
                <option value="finger-joints-normal">
                  Normal finger joints
                </option>
                <option value="finger-swelling">Finger joint swelling</option>
                <option value="finger-deformity">Finger joint deformity</option>
                <option value="limited-finger-rom">
                  Limited finger range of motion
                </option>
                <option value="trigger-finger">Trigger finger</option>
                <option value="dupuytren">Dupuytren's contracture</option>
              </optgroup>
              <optgroup label="Palmar">
                <option value="palmar-normal">Normal palmar surfaces</option>
                <option value="palmar-erythema">Palmar erythema</option>
                <option value="palmar-calluses">Palmar calluses</option>
                <option value="thenar-wasting">Thenar muscle wasting</option>
                <option value="hypothenar-wasting">
                  Hypothenar muscle wasting
                </option>
                <option value="osler-nodes">Osler nodes</option>
                <option value="janeway-lesions">Janeway lesions</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-hands-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-hands-others', 'pe-hands-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-hands-others-text"
                placeholder="Describe other hand findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Legs -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Legs</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search leg findings..."
              class="pe-search"
              data-target="pe-legs"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-legs"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="General">
                <option value="legs-normal">Normal legs and feet</option>
                <option value="legs-warm">Warm legs</option>
                <option value="legs-cold">Cold legs</option>
                <option value="feet-warm">Warm feet</option>
                <option value="feet-cold">Cold feet</option>
                <option value="legs-dry">Dry legs</option>
                <option value="legs-moist">Moist/clammy legs</option>
              </optgroup>
              <optgroup label="Circulation">
                <option value="pedal-pulses-normal">Normal pedal pulses</option>
                <option value="pedal-pulses-diminished">
                  Diminished pedal pulses
                </option>
                <option value="pedal-pulses-absent">Absent pedal pulses</option>
                <option value="dorsalis-pedis-present">
                  Dorsalis pedis pulse present
                </option>
                <option value="dorsalis-pedis-absent">
                  Dorsalis pedis pulse absent
                </option>
                <option value="posterior-tibial-present">
                  Posterior tibial pulse present
                </option>
                <option value="posterior-tibial-absent">
                  Posterior tibial pulse absent
                </option>
                <option value="capillary-refill-normal">
                  Normal capillary refill (<2 sec)
                </option>
                <option value="capillary-refill-delayed">
                  Delayed capillary refill (>2 sec)
                </option>
              </optgroup>
              <optgroup label="Edema">
                <option value="no-leg-edema">No leg edema</option>
                <option value="ankle-edema-mild">Mild ankle edema</option>
                <option value="ankle-edema-moderate">
                  Moderate ankle edema
                </option>
                <option value="ankle-edema-severe">Severe ankle edema</option>
                <option value="pitting-edema">Pitting edema</option>
                <option value="non-pitting-edema">Non-pitting edema</option>
                <option value="bilateral-leg-edema">Bilateral leg edema</option>
                <option value="unilateral-leg-edema">
                  Unilateral leg edema
                </option>
              </optgroup>
              <optgroup label="Skin & Appearance">
                <option value="leg-skin-normal">Normal leg skin</option>
                <option value="leg-cyanosis">Leg cyanosis</option>
                <option value="leg-pallor">Leg pallor</option>
                <option value="leg-erythema">Leg erythema</option>
                <option value="varicose-veins">Varicose veins</option>
                <option value="spider-veins">Spider veins</option>
                <option value="leg-ulcers">Leg ulcers</option>
                <option value="venous-stasis-changes">
                  Venous stasis changes
                </option>
                <option value="hair-loss-legs">Hair loss on legs</option>
                <option value="skin-atrophy-legs">Skin atrophy</option>
              </optgroup>
              <optgroup label="Movement & Function">
                <option value="normal-leg-movement">Normal leg movement</option>
                <option value="leg-weakness">Leg weakness</option>
                <option value="foot-drop">Foot drop</option>
                <option value="leg-pain-movement">Pain on leg movement</option>
                <option value="claudication-symptoms">
                  Claudication symptoms
                </option>
                <option value="restless-legs">Restless leg symptoms</option>
              </optgroup>
              <optgroup label="Deformities">
                <option value="no-leg-deformities">No leg deformities</option>
                <option value="bow-legs">Bow legs (genu varum)</option>
                <option value="knock-knees">Knock knees (genu valgum)</option>
                <option value="flat-feet">Flat feet</option>
                <option value="high-arches">High arches</option>
                <option value="bunions">Bunions</option>
                <option value="hammer-toes">Hammer toes</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-legs-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-legs-others', 'pe-legs-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-legs-others-text"
                placeholder="Describe other leg findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Vital Signs -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Vital Signs</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search vital signs..."
              class="pe-search"
              data-target="pe-vitals"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-vitals"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 80px;
              "
            >
              <option value="stable">Stable vital signs</option>
              <option value="hypertensive">Hypertensive</option>
              <option value="hypotensive">Hypotensive</option>
              <option value="tachycardic">Tachycardic</option>
              <option value="bradycardic">Bradycardic</option>
              <option value="tachypneic">Tachypneic</option>
              <option value="bradypneic">Bradypneic</option>
              <option value="febrile">Febrile</option>
              <option value="hypothermic">Hypothermic</option>
              <option value="hypoxic">Hypoxic (low O2 sat)</option>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-vitals-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-vitals-others', 'pe-vitals-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-vitals-others-text"
                placeholder="Describe other vital sign findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Cardiovascular -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Cardiovascular</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search cardiovascular findings..."
              class="pe-search"
              data-target="pe-cardiovascular"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-cardiovascular"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="Heart Sounds">
                <option value="rrr-normal">
                  Regular rate and rhythm, normal S1/S2
                </option>
                <option value="irregular">Irregular rhythm</option>
                <option value="s3-gallop">S3 gallop</option>
                <option value="s4-gallop">S4 gallop</option>
                <option value="murmur-systolic">Systolic murmur</option>
                <option value="murmur-early-systolic">
                  Early systolic murmur
                </option>
                <option value="murmur-late-systolic">
                  Late systolic murmur
                </option>
                <option value="murmur-diastolic">Diastolic murmur</option>
                <option value="murmur-early-diastolic">
                  Early diastolic murmur
                </option>
                <option value="murmur-late-diastolic">
                  Late diastolic murmur
                </option>
                <option value="murmur-holosystolic">Holosystolic murmur</option>
                <option value="rub">Pericardial friction rub</option>
                <option value="thrills">Thrills palpable</option>
              </optgroup>
              <optgroup label="Peripheral">
                <option value="pulses-normal">Normal peripheral pulses</option>
                <option value="pulses-diminished">
                  Diminished peripheral pulses
                </option>
                <option value="pulses-absent">Absent peripheral pulses</option>
                <option value="edema-none">No peripheral edema</option>
                <option value="edema-mild">Mild peripheral edema</option>
                <option value="edema-moderate">
                  Moderate peripheral edema
                </option>
                <option value="edema-severe">Severe peripheral edema</option>
                <option value="cyanosis">Cyanosis</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-cardiovascular-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-cardiovascular-others', 'pe-cardiovascular-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-cardiovascular-others-text"
                placeholder="Describe other cardiovascular findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Respiratory -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Respiratory</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search respiratory findings..."
              class="pe-search"
              data-target="pe-respiratory"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-respiratory"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="Inspection">
                <option value="chest-normal">Normal chest expansion</option>
                <option value="chest-asymmetric">
                  Asymmetric chest expansion
                </option>
                <option value="barrel-chest">Barrel chest</option>
                <option value="retractions">Intercostal retractions</option>
                <option value="accessory-muscles">
                  Use of accessory muscles
                </option>
                <option value="tracheal-deviation">Tracheal deviation</option>
                <option value="tracheal-tug">Tracheal tug</option>
              </optgroup>
              <optgroup label="Percussion">
                <option value="percussion-resonant">Resonant percussion</option>
                <option value="percussion-dull">Dull percussion</option>
                <option value="percussion-hyperresonant">
                  Hyperresonant percussion
                </option>
                <option value="percussion-stony-dull">
                  Stony dull percussion
                </option>
              </optgroup>
              <optgroup label="Auscultation">
                <option value="clear-bilateral">
                  Clear to auscultation bilaterally
                </option>
                <option value="wheeze">Wheeze</option>
                <option value="crackles">Crackles/Rales</option>
                <option value="rhonchi">Rhonchi</option>
                <option value="stridor">Stridor</option>
                <option value="diminished-sounds">
                  Diminished breath sounds
                </option>
                <option value="absent-sounds">Absent breath sounds</option>
                <option value="pleural-rub">Pleural friction rub</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-respiratory-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-respiratory-others', 'pe-respiratory-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-respiratory-others-text"
                placeholder="Describe other respiratory findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Abdominal -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Abdominal</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search abdominal findings..."
              class="pe-search"
              data-target="pe-abdominal"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-abdominal"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 120px;
              "
            >
              <optgroup label="Inspection">
                <option value="soft-nontender">
                  Soft, non-tender, non-distended
                </option>
                <option value="distended">Distended</option>
                <option value="scars">Surgical scars present</option>
                <option value="striae">Striae present</option>
              </optgroup>
              <optgroup label="Palpation">
                <option value="tender-generalized">
                  Generalized tenderness
                </option>
                <option value="tender-ruq">
                  Right upper quadrant tenderness
                </option>
                <option value="tender-luq">
                  Left upper quadrant tenderness
                </option>
                <option value="tender-rlq">
                  Right lower quadrant tenderness
                </option>
                <option value="tender-llq">
                  Left lower quadrant tenderness
                </option>
                <option value="tender-epigastric">Epigastric tenderness</option>
                <option value="tender-suprapubic">Suprapubic tenderness</option>
                <option value="guarding">Guarding</option>
                <option value="rigidity">Rigidity</option>
                <option value="rebound">Rebound tenderness</option>
                <option value="mass-palpable">Palpable mass</option>
                <option value="hepatomegaly">Hepatomegaly</option>
                <option value="splenomegaly">Splenomegaly</option>
              </optgroup>
              <optgroup label="Percussion">
                <option value="percussion-tympanic">Tympanic percussion</option>
                <option value="percussion-dull-abd">Dull percussion</option>
                <option value="shifting-dullness">
                  Shifting dullness (ascites)
                </option>
                <option value="fluid-thrill">Fluid thrill</option>
              </optgroup>
              <optgroup label="Auscultation">
                <option value="bowel-sounds-normal">Normal bowel sounds</option>
                <option value="bowel-sounds-hyperactive">
                  Hyperactive bowel sounds
                </option>
                <option value="bowel-sounds-hypoactive">
                  Hypoactive bowel sounds
                </option>
                <option value="bowel-sounds-absent">Absent bowel sounds</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-abdominal-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-abdominal-others', 'pe-abdominal-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-abdominal-others-text"
                placeholder="Describe other abdominal findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
          <!-- cleanup of duplicated lines handled by accordion refactor above -->
        </div>

        <!-- Neurological -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Neurological</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search neurological findings..."
              class="pe-search"
              data-target="pe-neurological"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <!-- Glasgow Coma Scale -->
            <div
              style="
                margin-bottom: 15px;
                padding: 10px;
                border: 1px solid var(--all-text);
                border-radius: 6px;
                background: var(--header-bg);
              "
            >
              <label
                style="font-weight: 600; margin-bottom: 8px; display: block"
                >Glasgow Coma Scale (GCS) - Total: /15</label
              >
              <div
                style="
                  display: flex;
                  gap: 15px;
                  align-items: center;
                  flex-wrap: wrap;
                "
              >
                <div style="flex: 1; min-width: 120px">
                  <label style="font-size: 13px; font-weight: 500"
                    >Eye Opening (/4)</label
                  >
                  <select
                    id="gcs-eye"
                    style="width: 100%; padding: 4px; font-size: 12px"
                  >
                    <option value="4">4 - Spontaneous</option>
                    <option value="3">3 - To voice</option>
                    <option value="2">2 - To pain</option>
                    <option value="1">1 - None</option>
                  </select>
                </div>
                <div style="flex: 1; min-width: 120px">
                  <label style="font-size: 13px; font-weight: 500"
                    >Verbal Response (/5)</label
                  >
                  <select
                    id="gcs-verbal"
                    style="width: 100%; padding: 4px; font-size: 12px"
                  >
                    <option value="5">5 - Oriented</option>
                    <option value="4">4 - Confused</option>
                    <option value="3">3 - Inappropriate words</option>
                    <option value="2">2 - Inappropriate sounds</option>
                    <option value="1">1 - None</option>
                  </select>
                </div>
                <div style="flex: 1; min-width: 120px">
                  <label style="font-size: 13px; font-weight: 500"
                    >Motor Response (/6)</label
                  >
                  <select
                    id="gcs-motor"
                    style="width: 100%; padding: 4px; font-size: 12px"
                  >
                    <option value="6">6 - Obeys commands</option>
                    <option value="5">5 - Moves to localized pain</option>
                    <option value="4">4 - Flextion withdrawal to pain</option>
                    <option value="3">
                      3 - Abnormal flextion (decorticate)
                    </option>
                    <option value="2">
                      2 - Abnormal extention (decerebrate)
                    </option>
                    <option value="1">1 - None</option>
                  </select>
                </div>
              </div>
            </div>

            <select
              id="pe-neurological"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 120px;
              "
            >
              <optgroup label="Mental Status">
                <option value="alert-oriented">Alert and oriented x3</option>
                <option value="confused">Confused</option>
                <option value="lethargic">Lethargic</option>
                <option value="obtunded">Obtunded</option>
                <option value="comatose">Comatose</option>
              </optgroup>
              <optgroup label="Cranial Nerves">
                <option value="cn-intact">Cranial nerves II-XII intact</option>
                <option value="cn-deficit">
                  Cranial nerve deficit present
                </option>
                <option value="pupils-equal">
                  Pupils equal, round, reactive to light
                </option>
                <option value="pupils-unequal">
                  Anisocoria (unequal pupils)
                </option>
                <option value="pupils-fixed">Fixed pupils</option>
              </optgroup>
              <optgroup label="Motor/Sensory">
                <option value="motor-normal">Normal motor strength 5/5</option>
                <option value="motor-weakness">Motor weakness present</option>
                <option value="sensory-intact">Sensation intact</option>
                <option value="sensory-deficit">Sensory deficit present</option>
                <option value="reflexes-normal">
                  Normal deep tendon reflexes
                </option>
                <option value="reflexes-hyperactive">
                  Hyperactive reflexes
                </option>
                <option value="reflexes-diminished">Diminished reflexes</option>
                <option value="reflexes-absent">Absent reflexes</option>
              </optgroup>
              <optgroup label="Coordination">
                <option value="coordination-normal">Normal coordination</option>
                <option value="ataxia">Ataxic gait</option>
                <option value="tremor">Tremor present</option>
                <option value="dysmetria">Dysmetria</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-neurological-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-neurological-others', 'pe-neurological-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-neurological-others-text"
                placeholder="Describe other neurological findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Musculoskeletal -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Musculoskeletal</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search musculoskeletal findings..."
              class="pe-search"
              data-target="pe-musculoskeletal"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-musculoskeletal"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="General">
                <option value="normal-rom">Normal range of motion</option>
                <option value="limited-rom">Limited range of motion</option>
                <option value="normal-strength">Normal muscle strength</option>
                <option value="weakness">Muscle weakness</option>
                <option value="atrophy">Muscle atrophy</option>
              </optgroup>
              <optgroup label="Joints">
                <option value="joints-normal">
                  No joint swelling or deformity
                </option>
                <option value="joint-swelling">Joint swelling present</option>
                <option value="joint-deformity">Joint deformity present</option>
                <option value="joint-warmth">Joint warmth/erythema</option>
                <option value="joint-effusion">Joint effusion</option>
              </optgroup>
              <optgroup label="Spine">
                <option value="spine-normal">Normal spinal curvature</option>
                <option value="kyphosis">Kyphosis</option>
                <option value="lordosis">Lordosis</option>
                <option value="scoliosis">Scoliosis</option>
                <option value="kyphoscoliosis">Kyphoscoliosis</option>
                <option value="spine-tenderness">Spinal tenderness</option>
              </optgroup>
              <optgroup label="Joint Deformities">
                <option value="varus-deformity">Varus deformity</option>
                <option value="valgus-deformity">Valgus deformity</option>
                <option value="patella-alta">Patella alta</option>
              </optgroup>
              <optgroup label="Specific Joints">
                <option value="cmc-joint">CMC joint abnormality</option>
                <option value="mp-joint">MP joint abnormality</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-musculoskeletal-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-musculoskeletal-others', 'pe-musculoskeletal-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-musculoskeletal-others-text"
                placeholder="Describe other musculoskeletal findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Dermatological -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Dermatological</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search skin findings..."
              class="pe-search"
              data-target="pe-dermatological"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-dermatological"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="General">
                <option value="skin-normal">
                  Normal skin color and texture
                </option>
                <option value="pallor">Pallor</option>
                <option value="cyanosis-skin">Cyanosis</option>
                <option value="jaundice-skin">Jaundice</option>
                <option value="erythema">Erythema</option>
              </optgroup>
              <optgroup label="Lesions">
                <option value="no-lesions">No skin lesions</option>
                <option value="rash-macular">Macular rash</option>
                <option value="rash-papular">Papular rash</option>
                <option value="rash-vesicular">Vesicular rash</option>
                <option value="rash-pustular">Pustular rash</option>
                <option value="petechiae">Petechiae</option>
                <option value="purpura">Purpura</option>
                <option value="ecchymoses">Ecchymoses/Bruising</option>
                <option value="spider-nevi">Spider nevi</option>
                <option value="ulceration">Skin ulceration</option>
              </optgroup>
              <optgroup label="Other">
                <option value="turgor-normal">Normal skin turgor</option>
                <option value="turgor-poor">
                  Poor skin turgor (dehydration)
                </option>
                <option value="diaphoresis">Diaphoresis</option>
                <option value="dry-skin">Dry skin</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-dermatological-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-dermatological-others', 'pe-dermatological-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-dermatological-others-text"
                placeholder="Describe other skin findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- ENT (Ear, Nose, Throat) -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>ENTO (Ear, Nose, Throat, Oral)</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search ENT findings..."
              class="pe-search"
              data-target="pe-ent"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-ent"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 120px;
              "
            >
              <optgroup label="Ears">
                <option value="ears-normal">Normal external ears</option>
                <option value="ear-discharge">Ear discharge</option>
                <option value="ear-erythema">Ear canal erythema</option>
                <option value="tympanic-normal">
                  Normal tympanic membranes
                </option>
                <option value="tympanic-erythema">
                  Erythematous tympanic membranes
                </option>
                <option value="tympanic-bulging">
                  Bulging tympanic membranes
                </option>
                <option value="tympanic-perforation">
                  Tympanic membrane perforation
                </option>
                <option value="cerumen-impaction">Cerumen impaction</option>
                <option value="tragal-tenderness">Tragal tenderness</option>
                <option value="mastoid-tenderness">Mastoid tenderness</option>
                <option value="tm-retraction">
                  Tympanic membrane retraction
                </option>
                <option value="middle-ear-effusion">Middle ear effusion</option>
                <option value="hearing-grossly-intact">
                  Hearing grossly intact
                </option>
              </optgroup>
              <optgroup label="Nose">
                <option value="nose-normal">Normal nasal passages</option>
                <option value="nasal-congestion">Nasal congestion</option>
                <option value="nasal-discharge">Nasal discharge</option>
                <option value="nasal-polyps">Nasal polyps</option>
                <option value="septum-deviated">Deviated nasal septum</option>
                <option value="epistaxis">Epistaxis</option>
                <option value="turbinate-hypertrophy">
                  Turbinate hypertrophy
                </option>
                <option value="septal-hematoma">Septal hematoma</option>
              </optgroup>
              <optgroup label="Throat/Oral">
                <option value="throat-normal">Normal oropharynx</option>
                <option value="throat-erythema">Pharyngeal erythema</option>
                <option value="throat-exudate">Pharyngeal exudate</option>
                <option value="tonsils-enlarged">Enlarged tonsils</option>
                <option value="tonsils-exudate">Tonsillar exudate</option>
                <option value="lymph-nodes">Cervical lymphadenopathy</option>
                <option value="uvula-deviation">Uvula deviation</option>
                <option value="oral-thrush">Oral thrush</option>
                <option value="oral-candida">Oral candida</option>
                <option value="aphthous-ulcers">Aphthous ulcers</option>
                <option value="koplik-spots">Koplik spots (measles)</option>
                <option value="forchheimer-spots">
                  Forchheimer spots (rubella)
                </option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-ent-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-ent-others', 'pe-ent-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-ent-others-text"
                placeholder="Describe other ENT findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Ophthalmological -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Ophthalmological</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search eye findings..."
              class="pe-search"
              data-target="pe-ophthalmological"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-ophthalmological"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="External">
                <option value="eyes-normal">Normal external eyes</option>
                <option value="conjunctiva-normal">Normal conjunctiva</option>
                <option value="conjunctiva-injection">
                  Conjunctival injection
                </option>
                <option value="sclera-icterus">Scleral icterus</option>
                <option value="eyelid-swelling">Eyelid swelling</option>
                <option value="eye-discharge">Eye discharge</option>
                <option value="chemosis">Chemosis</option>
                <option value="subconjunctival-hemorrhage">
                  Subconjunctival hemorrhage
                </option>
                <option value="blepharitis">Blepharitis</option>
                <option value="hordeolum">Hordeolum (stye)</option>
                <option value="chalazion">Chalazion</option>
                <option value="corneal-abrasion">Corneal abrasion</option>
                <option value="corneal-opacity">Corneal opacity</option>
              </optgroup>
              <optgroup label="Inspection">
                <option value="chest-normal">Normal chest appearance</option>
                <option value="barrel-chest">Barrel chest</option>
                <option value="pectus-excavatum">Pectus excavatum</option>
                <option value="pectus-carinatum">Pectus carinatum</option>
                <option value="kyphoscoliosis">Kyphoscoliosis</option>
                <option value="use-accessory">Use of accessory muscles</option>
                <option value="intercostal-retraction">
                  Intercostal retractions
                </option>
                <option value="cyanosis-resp">Central cyanosis</option>
              </optgroup>
              <optgroup label="Palpation">
                <option value="expansion-equal">Equal chest expansion</option>
                <option value="expansion-reduced">Reduced expansion</option>
                <option value="tactile-fremitus-normal">
                  Normal tactile fremitus
                </option>
                <option value="tactile-fremitus-increased">
                  Increased tactile fremitus
                </option>
                <option value="tactile-fremitus-decreased">
                  Decreased tactile fremitus
                </option>
              </optgroup>
              <optgroup label="Percussion">
                <option value="percussion-resonant">Resonant percussion</option>
                <option value="percussion-dull">Dull percussion</option>
                <option value="percussion-hyperresonant">
                  Hyperresonant percussion
                </option>
                <option value="percussion-stony-dull">
                  Stony dull percussion
                </option>
              </optgroup>
              <optgroup label="Auscultation">
                <option value="breath-sounds-normal">
                  Normal breath sounds
                </option>
                <option value="breath-sounds-diminished">
                  Diminished breath sounds
                </option>
                <option value="breath-sounds-absent">
                  Absent breath sounds
                </option>
                <option value="wheeze-resp">Wheeze</option>
                <option value="crackles">Crackles/Rales</option>
                <option value="rhonchi">Rhonchi</option>
                <option value="pleural-rub">Pleural friction rub</option>
                <option value="stridor">Stridor</option>
              </optgroup>
              <optgroup label="Pupils">
                <option value="pupils-normal-eye">
                  Pupils equal, round, reactive
                </option>
                <option value="pupils-dilated">Dilated pupils</option>
                <option value="pupils-constricted">Constricted pupils</option>
                <option value="pupils-unequal-eye">Unequal pupils</option>
                <option value="rapd">
                  Relative afferent pupillary defect (RAPD)
                </option>
                <option value="anisocoria">Anisocoria</option>
              </optgroup>
              <optgroup label="EOM/Alignment">
                <option value="eomi">
                  EOMI (extraocular movements intact)
                </option>
                <option value="eom-limitation">Limitation of EOM</option>
                <option value="nystagmus">Nystagmus</option>
                <option value="strabismus">Strabismus</option>
              </optgroup>
              <optgroup label="Vision">
                <option value="vision-grossly-normal">
                  Grossly normal vision
                </option>
                <option value="vision-impaired">Visual impairment</option>
                <option value="visual-fields-normal">
                  Normal visual fields
                </option>
                <option value="visual-fields-deficit">
                  Visual field deficit
                </option>
                <option value="decreased-visual-acuity">
                  Decreased visual acuity
                </option>
              </optgroup>
              <optgroup label="Fundoscopy">
                <option value="fundus-normal">Normal fundus</option>
                <option value="papilledema">Papilledema</option>
                <option value="av-nicking">AV nicking</option>
                <option value="cotton-wool-spots">Cotton wool spots</option>
                <option value="retinal-hemorrhages">Retinal hemorrhages</option>
                <option value="diabetic-retinopathy">
                  Diabetic retinopathy changes
                </option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-ophthalmological-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-ophthalmological-others', 'pe-ophthalmological-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-ophthalmological-others-text"
                placeholder="Describe other eye findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Genitourinary -->
        <div class="form-subsection" style="margin-top: 25px">
          <button
            type="button"
            class="pe-accordion-header"
            style="
              width: 100%;
              text-align: left;
              font-size: 16px;
              font-weight: 700;
              padding: 10px 12px;
              border: 1px solid var(--all-text);
              border-radius: 6px;
              background: var(--header-bg);
              color: var(--all-text);
              display: flex;
              align-items: center;
              justify-content: space-between;
              cursor: pointer;
            "
          >
            <span>Genitourinary</span>
            <span class="chev" style="opacity: 0.8">▸</span>
          </button>
          <div
            class="pe-accordion-content"
            style="
              display: none;
              padding: 10px 12px;
              border: 1px dashed var(--all-text);
              border-top: none;
              border-radius: 0 0 6px 6px;
            "
          >
            <input
              type="text"
              placeholder="Search GU findings..."
              class="pe-search"
              data-target="pe-genitourinary"
              style="
                width: 100%;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 13px;
                border: 1px solid var(--all-text);
                border-radius: 4px;
                background: var(--header-bg);
                color: var(--all-text);
              "
            />
            <select
              id="pe-genitourinary"
              multiple
              style="
                width: 100%;
                padding: 8px;
                font-size: 14px;
                min-height: 100px;
              "
            >
              <optgroup label="General">
                <option value="gu-deferred">Examination deferred</option>
                <option value="external-normal">
                  Normal external genitalia
                </option>
                <option value="costovertebral-negative">
                  No costovertebral angle tenderness
                </option>
                <option value="costovertebral-positive">
                  Costovertebral angle tenderness
                </option>
              </optgroup>
              <optgroup label="Male">
                <option value="testes-normal">Normal testes</option>
                <option value="testes-swelling">Testicular swelling</option>
                <option value="hernia-absent">No inguinal hernia</option>
                <option value="hernia-present">Inguinal hernia present</option>
                <option value="epididymal-tenderness">
                  Epididymal tenderness
                </option>
                <option value="scrotal-swelling">Scrotal swelling</option>
                <option value="penile-lesions">Penile lesions</option>
                <option value="urethral-discharge">Urethral discharge</option>
                <option value="prostate-enlarged">Prostate enlarged</option>
                <option value="prostate-tender">Prostate tender</option>
              </optgroup>
              <optgroup label="Female">
                <option value="pelvic-deferred">
                  Pelvic examination deferred
                </option>
                <option value="pelvic-normal">Normal pelvic examination</option>
                <option value="cervical-discharge">Cervical discharge</option>
                <option value="adnexal-tenderness">Adnexal tenderness</option>
                <option value="cmt">Cervical motion tenderness</option>
                <option value="uterine-enlargement">Uterine enlargement</option>
                <option value="adnexal-mass">Adnexal mass</option>
                <option value="vaginal-discharge">Vaginal discharge</option>
              </optgroup>
            </select>

            <!-- Others (Specify) option -->
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                border: 1px dashed var(--all-text);
                border-radius: 4px;
              "
            >
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  cursor: pointer;
                "
              >
                <input
                  type="checkbox"
                  id="pe-genitourinary-others"
                  style="margin: 0"
                  onchange="togglePEOthersInput('pe-genitourinary-others', 'pe-genitourinary-others-text')"
                />
                <span style="font-weight: 500">Others (Specify):</span>
              </label>
              <input
                type="text"
                id="pe-genitourinary-others-text"
                placeholder="Describe other GU findings..."
                disabled
                style="
                  width: 100%;
                  margin-top: 6px;
                  padding: 6px;
                  font-size: 13px;
                  border: 1px solid var(--all-text);
                  border-radius: 3px;
                  background: var(--header-bg);
                  color: var(--all-text);
                  opacity: 0.6;
                "
              />
            </div>
          </div>
        </div>

        <!-- Additional Findings -->
        <div class="form-subsection" style="margin-top: 25px">
          <label
            for="pe-additional"
            style="
              font-size: 16px;
              font-weight: 700;
              margin-bottom: 12px;
              display: block;
            "
            >Additional Findings</label
          >
          <textarea
            id="pe-additional"
            placeholder="Any additional physical examination findings not covered above..."
            style="
              width: 100%;
              box-sizing: border-box;
              padding: 8px;
              font-size: 14px;
              min-height: 60px;
            "
          ></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Separator between AI section and history form -->
  <hr
    id="ai-section-separator"
    style="
      margin: 20px 0 30px 0;
      border: 0;
      border-top: 1px solid var(--all-text);
      opacity: 1;
      width: 100%;
      margin-top: 30px;
    "
  />

  <!-- Student Notes Section -->
  <div class="form-section" style="margin-top: 30px">
    <h2
      style="
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--all-text);
      "
    >
      Student Notes & Analysis
    </h2>
    <div class="form-subsection">
      <label
        for="student-notes"
        style="
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 8px;
          display: block;
          color: var(--all-text);
        "
      >
        Additional Notes & Clinical Reasoning
      </label>
      <p
        style="
          font-size: 13px;
          color: var(--all-text);
          opacity: 0.8;
          margin-bottom: 10px;
          line-height: 1.4;
        "
      >
        Add your clinical thoughts, differential diagnoses, reasoning, or any
        additional observations. The AI will consider these notes when analyzing
        the case to provide more accurate and personalized insights.
      </p>
      <textarea
        id="student-notes"
        placeholder="Example: Patient appears anxious about symptoms. Considering differential of acute coronary syndrome vs. anxiety disorder based on presentation. Need to rule out cardiac causes first given chest pain characteristics..."
        style="
          width: 100%;
          box-sizing: border-box;
          padding: 12px;
          font-size: 14px;
          min-height: 120px;
          border: 2px dashed var(--all-text);
          border-radius: 8px;
          background: var(--header-bg);
          color: var(--all-text);
          resize: vertical;
          line-height: 1.5;
        "
      ></textarea>
    </div>
  </div>

  <!-- Separator between AI section and history form -->
  <hr
    id="ai-section-separator"
    style="
      margin: 20px 0 30px 0;
      border: 0;
      border-top: 1px solid var(--all-text);
      opacity: 1;
      width: 100%;
      margin-top: 30px;
    "
  />

  <!-- AI Model Selector -->
  <div class="form-section" style="margin-top: 0px; margin-bottom: 20px">
    <!-- Decoy fields to appease password managers -->
    <div
      aria-hidden="true"
      style="
        position: absolute;
        left: -99999px;
        top: -99999px;
        opacity: 0;
        pointer-events: none;
        height: 0;
        overflow: hidden;
      "
    >
      <input type="text" name="email" autocomplete="username" />
      <input type="password" name="password" autocomplete="current-password" />
    </div>
    <label
      for="ai-model"
      style="font-weight: 600; display: flex; align-items: center; gap: 8px"
    >
      AI Model
      <div
        id="ai-model-status"
        style="font-size: 12px; color: var(--all-text); opacity: 0.8"
      >
        Model: (none selected)
      </div>
    </label>

    <select
      id="ai-model"
      name="no_autofill_ai_model_7c1f1b"
      autocomplete="off"
      data-lpignore="true"
      data-1p-ignore="true"
      data-bwignore="true"
      style="width: 100%; box-sizing: border-box; padding: 8px; font-size: 14px"
    >
      <option value="" disabled selected>
        Select AI model - If no model is selected, AI will remain off
      </option>
      <option value="gemini-1.5-flash">
        Gemini 1.5 Flash (Recommended - Free Tier)
      </option>
      <option value="gemini-1.5-pro">
        Gemini 1.5 Pro (Advanced - Limited Quota)
      </option>
      <option value="gemini-1.0-pro">Gemini 1.0 Pro (Legacy)</option>
    </select>

    <div
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
      "
    >
      <button
        id="ai-generate"
        type="button"
        style="
          width: 35%;
          padding: 12px;
          margin-top: 15px auto;
          margin-bottom: -27px;
          background: var(--report) !important ;
          color: var(--scrl);
          border: 1px dashed var(--all-text);
          border-radius: 20px;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          z-index: 9999;
        "
      >
        Get Report
      </button>
    </div>

    <!-- Status Box -->
    <div
      id="report-status"
      style="
        display: none;
        margin-top: 15px;
        padding: 20px;
        background: var(--userdiv);
        border: 1px solid var(--all-text);
        border-radius: 8px;
        font-size: 13px;
        text-align: center;
        margin-bottom: -28px;
      "
    >
      <div
        style="
          margin-bottom: 15px;
          font-weight: 600;
          color: var(--all-text);
          font-size: 14px;
        "
      >
        Report Generation Progress
      </div>
      <div
        id="status-step-1"
        class="status-step"
        style="
          margin-bottom: 12px;
          color: var(--all-text);
          opacity: 0.6;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        "
      >
        <span class="status-icon">○</span> Sending inputs to the client...
      </div>
      <div
        id="status-step-2"
        class="status-step"
        style="
          margin-bottom: 12px;
          color: var(--all-text);
          opacity: 0.6;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        "
      >
        <span class="status-icon">○</span> Report setting up...
      </div>
      <div
        id="status-step-3"
        class="status-step"
        style="
          margin-bottom: 12px;
          color: var(--all-text);
          opacity: 0.6;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        "
      >
        <span class="status-icon">○</span> Requesting an AI assessment...
      </div>
      <div
        id="status-step-4"
        class="status-step"
        style="
          margin-bottom: 0;
          color: var(--all-text);
          opacity: 0.6;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        "
      >
        <span class="status-icon">○</span> Finishing up...
      </div>
    </div>

    <style>
      .loading-spinner {
        width: 12px;
        height: 12px;
        border: 2px solid rgba(135, 206, 250, 0.3);
        border-top: 2px solid #87CEEFA;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: inline-block;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .status-step {
        transition: opacity 0.3s ease;
      }
    </style>

    <div
      id="ai-output"
      style="
        margin-top: 15px;
        padding: 0;
        border-radius: 8px;
        background: transparent;
        min-height: 0;
        display: none;
      "
    ></div>

    <div
      id="ai-token-hint"
      style="font-size: 12px; color: var(--all-text); margin-top: 6px"
    >
      Firebase AI Logic integration - Direct access to Gemini models. No server
      required.
    </div>
  </div>

  <script>
    // IMMEDIATE TEST - This should execute first
    console.log("IMMEDIATE TEST: Script started");
    window.immediateTest = function () {
      return "WORKS";
    };

    (function () {
      const OVERLAY_ID = "offline-overlay-bau";
      const FOOTER_ID = "offline-footer-bau";

      function formatNow() {
        try {
          return new Date().toLocaleString();
        } catch (e) {
          return new Date().toString();
        }
      }

      function buildOverlay() {
        if (document.getElementById(OVERLAY_ID)) return;
        const overlay = document.createElement("div");
        overlay.id = OVERLAY_ID;
        overlay.style.position = "fixed";
        overlay.style.inset = "0";
        overlay.style.display = "flex";
        overlay.style.alignItems = "flex-start"; // lift slightly upward
        overlay.style.justifyContent = "center";
        overlay.style.paddingTop = "37vh";
        overlay.style.paddingLeft = "20px";
        overlay.style.paddingRight = "20px";
        overlay.style.background = "rgba(0,0,0,0.25)";
        overlay.style.backdropFilter = "blur(4px)";
        overlay.style.WebkitBackdropFilter = "blur(4px)";
        overlay.style.zIndex = "9999";

        const card = document.createElement("div");
        card.style.textAlign = "center";
        card.style.maxWidth = "560px";
        card.style.color = "var(--all-text)";
        card.style.background = "rgba(150,150,150,0.12)";
        card.style.border = "1px solid rgba(150,150,150,0.3)";
        card.style.borderRadius = "12px";
        card.style.padding = "24px 18px";
        card.style.backdropFilter = "blur(6px)";
        card.style.WebkitBackdropFilter = "blur(6px)";

        const title = document.createElement("div");
        title.textContent = "Oops!";
        title.style.fontSize = "20px";
        title.style.fontWeight = "600";
        title.style.marginBottom = "8px";

        const msg = document.createElement("div");
        msg.style.fontSize = "16px";
        msg.style.fontWeight = "400";
        msg.innerHTML =
          "Seems like your connection is weak or disturbed :( If things aren't loading, re-connect to Wi‑Fi or use mobile data.";

        card.appendChild(title);
        card.appendChild(msg);
        overlay.appendChild(card);
        document.body.appendChild(overlay);

        // footer
        if (!document.getElementById(FOOTER_ID)) {
          const footer = document.createElement("div");
          footer.id = FOOTER_ID;
          footer.style.position = "fixed";
          footer.style.left = "0";
          footer.style.right = "0";
          footer.style.bottom = "0";
          footer.style.padding = "8px 12px";
          footer.style.fontSize = "12px";
          footer.style.textAlign = "center";
          footer.style.color = "var(--all-text)";
          footer.style.background = "rgba(0,0,0,0.25)";
          footer.style.backdropFilter = "blur(6px)";
          footer.style.WebkitBackdropFilter = "blur(6px)";
          footer.style.zIndex = "10000";

          function renderFooter() {
            footer.textContent = `Socrates Beta. ${formatNow()}. v1.13 LS. v1.20 GS.`;
          }
          renderFooter();
          document.body.appendChild(footer);

          // update time periodically while offline
          if (!footer._interval) {
            footer._interval = setInterval(renderFooter, 1000);
          }
        }
      }

      function removeOverlay() {
        const overlay = document.getElementById(OVERLAY_ID);
        if (overlay) overlay.remove();
        const footer = document.getElementById(FOOTER_ID);
        if (footer) {
          if (footer._interval) clearInterval(footer._interval);
          footer.remove();
        }
      }

      function refreshState() {
        if (navigator.onLine === false) buildOverlay();
        else removeOverlay();
      }

      window.addEventListener("offline", buildOverlay);
      window.addEventListener("online", removeOverlay);
      // initialize after DOM ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", refreshState);
      } else {
        refreshState();
      }
    })();

    // PE Toggle Function for bau.html
    function togglePESection() {
      const peContent = document.getElementById("pe-content");
      const peToggle = document.getElementById("pe-toggle");

      if (!peContent || !peToggle) return;

      const isHidden =
        peContent.style.display === "none" || peContent.style.display === "";

      if (isHidden) {
        // Show PE section
        peContent.style.display = "block";
        setTimeout(() => {
          peContent.style.opacity = "1";
          // Initialize checkbox-based UI for PE after section is shown
          initPECheckboxUI();
          console.log("[PE DEBUG] PE section shown, initializing accordions");
          initPEAccordions();
        }, 10);

        // Update switch to ON state - CSS handles the styling
        peToggle.checked = true;
      } else {
        // Hide PE section
        peContent.style.opacity = "0";
        setTimeout(() => {
          peContent.style.display = "none";
        }, 500);

        // Update switch to OFF state - CSS handles the styling
        peToggle.checked = false;
      }
    }

    // Initialize PE accordions using delegated click handling
    function initPEAccordions() {
      console.log("[PE DEBUG] initPEAccordions called");
      const peRoot = document.getElementById("pe-content");
      if (!peRoot) {
        console.error("[PE DEBUG] pe-content not found");
        return;
      }
      console.log("[PE DEBUG] pe-content found:", peRoot);

      // Attach delegated handler once
      if (peRoot.dataset.accordionDelegated !== "1") {
        console.log("[PE DEBUG] Setting up delegated click handler");
        peRoot.dataset.accordionDelegated = "1";
        peRoot.addEventListener("click", (e) => {
          console.log("[PE DEBUG] Delegated click detected:", e.target);
          const header = e.target.closest(".pe-accordion-header");
          console.log("[PE DEBUG] Closest header found:", header);
          if (!header || !peRoot.contains(header)) {
            console.log("[PE DEBUG] No valid header found or not in peRoot");
            return;
          }
          e.preventDefault();
          console.log(
            "[PE DEBUG] Calling toggleAccordion from delegated handler"
          );
          toggleAccordion(header);
        });
      } else {
        console.log("[PE DEBUG] Delegated handler already set up");
      }

      // Also attach direct handlers to each header (idempotent) and add a11y
      const headers = peRoot.querySelectorAll(".pe-accordion-header");
      console.log("[PE DEBUG] Found headers:", headers.length);
      headers.forEach((header, index) => {
        console.log(
          "[PE DEBUG] Processing header",
          index,
          ":",
          header.textContent.trim()
        );
        if (header.dataset.accordionBound === "1") {
          console.log("[PE DEBUG] Header", index, "already bound");
          return;
        }
        header.dataset.accordionBound = "1";
        header.setAttribute("aria-expanded", "false");
        header.setAttribute("aria-controls", "");
        header.setAttribute("role", "button");

        header.addEventListener("click", (e) => {
          console.log(
            "[PE DEBUG] Direct click on header:",
            header.textContent.trim()
          );
          e.preventDefault();
          e.stopPropagation();
          toggleAccordion(header);
        });
        header.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            console.log(
              "[PE DEBUG] Keyboard activation on header:",
              header.textContent.trim()
            );
            e.preventDefault();
            toggleAccordion(header);
          }
        });
        console.log("[PE DEBUG] Bound events to header", index);
      });

      function toggleAccordion(header) {
        console.log(
          "[PE DEBUG] toggleAccordion called for:",
          header.textContent.trim()
        );
        const content = header.nextElementSibling;
        console.log("[PE DEBUG] Next sibling:", content);
        if (!content) {
          console.error("[PE DEBUG] No next sibling found");
          return;
        }
        if (!content.classList.contains("pe-accordion-content")) {
          console.error(
            "[PE DEBUG] Next sibling is not pe-accordion-content:",
            content.className
          );
          return;
        }
        const chev = header.querySelector(".chev");
        console.log("[PE DEBUG] Chevron element:", chev);
        const currentDisplay = (content.style && content.style.display) || "";
        const computed = window.getComputedStyle
          ? getComputedStyle(content).display
          : currentDisplay;
        const isOpen = (currentDisplay || computed) === "block";
        console.log(
          "[PE DEBUG] Current display:",
          currentDisplay,
          "Computed:",
          computed,
          "IsOpen:",
          isOpen
        );

        const newDisplay = isOpen ? "none" : "block";
        content.style.display = newDisplay;
        console.log("[PE DEBUG] Set display to:", newDisplay);
        console.log(
          "[PE DEBUG] Actual style after set:",
          content.style.display
        );

        header.setAttribute("aria-expanded", String(!isOpen));
        if (chev) {
          const newChev = isOpen ? "▸" : "▾";
          chev.textContent = newChev;
          console.log("[PE DEBUG] Set chevron to:", newChev);
        }
        console.log(
          "[PE DEBUG] Accordion toggle complete for:",
          header.textContent.trim(),
          "->",
          !isOpen ? "OPEN" : "CLOSED"
        );
      }

      console.log("[PE DEBUG] initPEAccordions setup complete");
    }

    // Build checkbox UI for all PE <select multiple> controls
    function initPECheckboxUI() {
      const peRoot = document.getElementById("pe-content");
      if (!peRoot) return;

      const selects = peRoot.querySelectorAll("select[multiple]");
      selects.forEach((sel) => {
        if (sel.dataset.cbBuilt === "1") return;

        const list = document.createElement("div");
        list.className = "pe-checkbox-list";
        list.style.display = "grid";
        list.style.gridTemplateColumns = "repeat(auto-fit, minmax(220px, 1fr))";
        list.style.gap = "6px 12px";
        list.style.marginTop = "6px";

        // Not found message per section
        const noRes = document.createElement("div");
        noRes.textContent = "Not found";
        noRes.style.display = "none";
        noRes.style.gridColumn = "1/-1";
        noRes.style.opacity = "0.8";
        noRes.style.fontStyle = "italic";
        noRes.style.padding = "6px 0";

        const addCb = (opt) => {
          const id = `${sel.id || "pe"}-${opt.value}`;
          const label = document.createElement("label");
          label.setAttribute("for", id);
          label.style.display = "flex";
          label.style.alignItems = "center";
          label.style.gap = "8px";
          label.style.padding = "6px 8px";
          label.style.border = "1px solid var(--all-text)";
          label.style.borderRadius = "6px";
          label.style.background = "var(--header-bg)";
          label.style.color = "var(--all-text)";

          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.id = id;
          cb.value = opt.value;
          cb.checked = !!opt.selected;

          cb.addEventListener("change", () => {
            opt.selected = cb.checked;
            const evt = new Event("change", { bubbles: true });
            sel.dispatchEvent(evt);
          });

          const span = document.createElement("span");
          span.textContent = opt.textContent;

          label.appendChild(cb);
          label.appendChild(span);
          list.appendChild(label);
        };

        const groups = sel.querySelectorAll("optgroup");
        if (groups.length) {
          groups.forEach((grp) => {
            const header = document.createElement("div");
            header.textContent = grp.label || "";
            header.style.fontWeight = "700";
            header.style.margin = "8px 0 4px";
            header.style.gridColumn = "1/-1";
            list.appendChild(header);
            grp.querySelectorAll("option").forEach(addCb);
          });
        } else {
          sel.querySelectorAll("option").forEach(addCb);
        }

        // Append the Not found message at the end of the list grid
        list.appendChild(noRes);

        sel.insertAdjacentElement("afterend", list);
        sel.style.display = "none";
        sel.dataset.cbBuilt = "1";

        if (sel.id) {
          const search = peRoot.querySelector(
            `.pe-search[data-target="${sel.id}"]`
          );
          if (search && !search.dataset.bound) {
            search.dataset.bound = "1";
            search.addEventListener("input", () => {
              const q = search.value.trim().toLowerCase();
              let matches = 0;
              list.querySelectorAll("label").forEach((lab) => {
                const txt = (lab.textContent || "").toLowerCase();
                const show = !q || txt.includes(q);
                lab.style.display = show ? "flex" : "none";
                if (show) matches++;
              });
              noRes.style.display = matches === 0 ? "block" : "none";
            });

            // Trigger once to set correct initial state if there's a preset value
            const evt = new Event("input", { bubbles: false });
            search.dispatchEvent(evt);
          }
        }
      });
    }

    // Touch-friendly multi-select for iPad users
    function initTouchMultiSelect() {
      const peSelects = document.querySelectorAll(
        "#pe-content select[multiple]"
      );

      peSelects.forEach((select) => {
        if (select.dataset.touchInitialized) return;
        select.dataset.touchInitialized = "true";

        // Add search functionality that works with touch interface
        const searchInput = select.parentNode.querySelector(".pe-search");
        if (searchInput) {
          searchInput.addEventListener("input", (e) => {
            const searchTerm = e.target.value.toLowerCase();

            // Update the touch interface buttons if they exist
            const wrapper = select.nextElementSibling;
            if (wrapper && wrapper.className === "touch-multiselect-wrapper") {
              const buttons = wrapper.querySelectorAll(
                ".touch-options-container button"
              );
              buttons.forEach((btn) => {
                const text = btn.textContent.toLowerCase();
                const shouldShow =
                  text.includes(searchTerm) || searchTerm === "";
                btn.style.display = shouldShow ? "block" : "none";
              });
            }

            // Also update native select options for desktop
            const options = select.querySelectorAll("option");
            options.forEach((option) => {
              const text = option.textContent.toLowerCase();
              const shouldShow = text.includes(searchTerm) || searchTerm === "";
              option.style.display = shouldShow ? "block" : "none";
            });
          });
        }

        // Create custom multi-select interface
        const wrapper = document.createElement("div");
        wrapper.className = "touch-multiselect-wrapper";
        wrapper.style.cssText = `
        border: 1px solid var(--all-text);
        border-radius: 6px;
        background: var(--header-bg);
        min-height: 80px;
        max-height: 200px;
        overflow-y: auto;
        padding: 8px;
        margin-top: 5px;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
      `;

        // Prevent wrapper from causing page scroll
        wrapper.addEventListener("touchstart", (e) => {
          e.stopPropagation();
        });

        wrapper.addEventListener("touchmove", (e) => {
          e.stopPropagation();
        });

        const selectedDisplay = document.createElement("div");
        selectedDisplay.className = "selected-items-display";
        selectedDisplay.style.cssText = `
        min-height: 20px;
        font-size: 12px;
        color: var(--all-text);
        opacity: 0.8;
        margin-bottom: 8px;
        font-style: italic;
      `;
        selectedDisplay.textContent =
          "Tap options below to select multiple items";

        const optionsContainer = document.createElement("div");
        optionsContainer.className = "touch-options-container";

        // Convert select options to touch-friendly buttons
        Array.from(select.options).forEach((option) => {
          if (option.disabled) return;

          const optionBtn = document.createElement("button");
          optionBtn.type = "button";
          optionBtn.textContent = option.text;
          optionBtn.dataset.value = option.value;
          optionBtn.style.cssText = `
          display: block;
          width: 100%;
          text-align: left;
          padding: 8px 12px;
          margin: 2px 0;
          border: 1px solid transparent;
          background: transparent;
          color: var(--all-text);
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s ease;
          font-size: 13px;
          -webkit-tap-highlight-color: transparent;
          touch-action: none;
        `;

          optionBtn.addEventListener(
            "click",
            (e) => {
              e.preventDefault();
              e.stopPropagation();

              const prevRestore = (history && history.scrollRestoration) || "";
              try {
                if (history && "scrollRestoration" in history)
                  history.scrollRestoration = "manual";
              } catch {}

              // Store current scroll position and blur any focused element
              const scrollY = window.scrollY || window.pageYOffset;
              if (
                document.activeElement &&
                typeof document.activeElement.blur === "function"
              ) {
                document.activeElement.blur();
              }

              option.selected = !option.selected;
              updateTouchSelectDisplay(
                select,
                selectedDisplay,
                optionsContainer
              );

              // Trigger change event for form data management
              select.dispatchEvent(
                new Event("change", { bubbles: true, cancelable: true })
              );

              // Restore scroll position using double RAF to defeat iOS jumps
              requestAnimationFrame(() => {
                window.scrollTo(0, scrollY);
                requestAnimationFrame(() => {
                  window.scrollTo(0, scrollY);
                  try {
                    if (history && "scrollRestoration" in history)
                      history.scrollRestoration = prevRestore || "auto";
                  } catch {}
                });
              });

              return false;
            },
            { passive: false }
          );

          // Add touchstart and touchend events to prevent scrolling
          optionBtn.addEventListener(
            "touchstart",
            (e) => {
              e.preventDefault();
              e.stopPropagation();
              e.stopImmediatePropagation();
              return false;
            },
            { passive: false }
          );

          optionBtn.addEventListener(
            "touchend",
            (e) => {
              e.preventDefault();
              e.stopPropagation();
              e.stopImmediatePropagation();

              const prevRestore = (history && history.scrollRestoration) || "";
              try {
                if (history && "scrollRestoration" in history)
                  history.scrollRestoration = "manual";
              } catch {}

              // Store current scroll position and blur any focused element
              const scrollY = window.scrollY || window.pageYOffset;
              if (
                document.activeElement &&
                typeof document.activeElement.blur === "function"
              ) {
                document.activeElement.blur();
              }

              option.selected = !option.selected;
              updateTouchSelectDisplay(
                select,
                selectedDisplay,
                optionsContainer
              );
              select.dispatchEvent(
                new Event("change", { bubbles: true, cancelable: true })
              );

              // Restore scroll position using double RAF
              requestAnimationFrame(() => {
                window.scrollTo(0, scrollY);
                requestAnimationFrame(() => {
                  window.scrollTo(0, scrollY);
                  try {
                    if (history && "scrollRestoration" in history)
                      history.scrollRestoration = prevRestore || "auto";
                  } catch {}
                });
              });

              return false;
            },
            { passive: false }
          );

          // Guard against mouse-based scroll on some devices
          optionBtn.addEventListener("mousedown", (e) => {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          });

          optionsContainer.appendChild(optionBtn);
        });

        wrapper.appendChild(selectedDisplay);
        wrapper.appendChild(optionsContainer);

        // Hide original select and insert custom interface
        select.style.display = "none";
        select.parentNode.insertBefore(wrapper, select.nextSibling);

        // Initial display update
        updateTouchSelectDisplay(select, selectedDisplay, optionsContainer);
      });
    }

    function updateTouchSelectDisplay(
      select,
      selectedDisplay,
      optionsContainer
    ) {
      const selectedOptions = Array.from(select.selectedOptions);
      const buttons = optionsContainer.querySelectorAll("button");

      // Update button styles
      buttons.forEach((btn) => {
        const isSelected = selectedOptions.some(
          (opt) => opt.value === btn.dataset.value
        );
        if (isSelected) {
          btn.style.background = "var(--all-text)";
          btn.style.color = "var(--all-text)";
          btn.style.border = "3px solid #87CEEB";
        } else {
          btn.style.background = "transparent";
          btn.style.color = "var(--all-text)";
          btn.style.border = "1px solid transparent";
        }

        // Add hover effect
        btn.onmouseenter = () => {
          if (!isSelected) {
            btn.style.background = "rgba(128, 128, 128, 0.1)";
            btn.style.borderColor = "var(--all-text)";
            btn.style.color = "var(--all-text)";
          }
        };
        btn.onmouseleave = () => {
          if (!isSelected) {
            btn.style.background = "transparent";
            btn.style.border = "1px solid transparent";
            btn.style.color = "var(--all-text)";
          }
        };
      });

      // Update selected items display
      if (selectedOptions.length === 0) {
        selectedDisplay.textContent =
          "Tap options below to select multiple items";
        selectedDisplay.style.fontStyle = "italic";
      } else {
        selectedDisplay.textContent = `Selected: ${selectedOptions
          .map((opt) => opt.text)
          .join(", ")}`;
        selectedDisplay.style.fontStyle = "normal";
      }
    }

    // Immediately define global test functions
    console.log("[PE DEBUG] Defining global test functions...");

    window.testPEAccordions = function () {
      console.log("=== PE ACCORDION TEST ===");
      const peContent = document.getElementById("pe-content");
      console.log("PE Content element:", peContent);
      console.log(
        "PE Content display:",
        peContent ? peContent.style.display : "NOT FOUND"
      );

      const headers = document.querySelectorAll(".pe-accordion-header");
      console.log("Found accordion headers:", headers.length);
      headers.forEach((h, i) => console.log(`  ${i}: ${h.textContent.trim()}`));

      const contents = document.querySelectorAll(".pe-accordion-content");
      console.log("Found accordion contents:", contents.length);
      contents.forEach((c, i) =>
        console.log(`  ${i}: display=${c.style.display}`)
      );

      return { peContent, headers, contents };
    };

    window.toggleFirstAccordion = function () {
      const header = document.querySelector(".pe-accordion-header");
      if (header) {
        console.log(
          "Manually clicking first accordion header:",
          header.textContent.trim()
        );
        header.click();
        return true;
      } else {
        console.log("No accordion headers found");
        return false;
      }
    };

    window.showPESection = function () {
      const toggle = document.getElementById("pe-toggle");
      if (toggle && !toggle.checked) {
        console.log("Manually toggling PE section ON");
        toggle.click();
        return true;
      } else {
        console.log("PE toggle not found or already ON");
        return false;
      }
    };

    console.log(
      "[PE DEBUG] Global functions defined:",
      typeof window.testPEAccordions,
      typeof window.showPESection,
      typeof window.toggleFirstAccordion
    );

    // Cross-form symptom linking functionality
    console.log("[SYMPTOM LINK] About to define initSymptomLinking function");

    // Simple test function first
    window.testSymptomLink = function () {
      console.log("[SYMPTOM LINK] Test function works!");
      return "Function is accessible";
    };

    window.initSymptomLinking = function () {
      console.log("[SYMPTOM LINK] initSymptomLinking function called");
      const symptomMappings = {
        // Chief Complaint to ROS mappings
        "chest-pain": ["Chest pain"],
        palpitations: ["Palpitations"],
        "shortness-breath": ["Shortness of breath"],
        cough: ["Cough"],
        wheeze: ["Wheeze"],
        hemoptysis: ["Haemoptysis"],
        "abdominal-pain": ["Abdominal pain"],
        "nausea-vomiting": ["Nausea", "Vomiting"],
        // Align to actual ROS checkbox value
        diarrhea: ["Diarrhea"],
        constipation: ["Constipation"],
        headache: ["Headache"],
        dizziness: ["Dizziness"],
        weakness: ["Weakness"],
        numbness: ["Numbness"],
        "joint-pain": ["Joint pain"],
        "back-pain": ["Back pain"],
        dysuria: ["Dysuria"],
        frequency: ["Frequency"],
        urgency: ["Urgency"],
        hematuria: ["Haematuria"],
        incontinence: ["Incontinence"],
        discharge: ["Discharge"],
        nocturia: ["Nocturia"],
        // GI bleeding-related
        melena: ["Bleeding"],
        hematochezia: ["Bleeding"],
        "gi-bleeding": ["Bleeding"],

        // Associated Symptoms to ROS mappings
        fever: ["Fever"],
        "night-sweats": ["Night sweats"],
        sweating: ["Sweating"],
        "excessive-sweating": ["Sweating"],
        fatigue: ["Fatigue"],
        "weight-loss": ["Weight loss"],
        orthopnea: ["Orthopnoea"],
        pnd: ["PND"],
        "leg-swelling": ["Leg swelling"],
        syncope: ["Syncope"],
        "nausea-cvs": ["Nausea"],
        "vomiting-cvs": ["Vomiting"],
        nausea: ["Nausea"],
        vomiting: ["Vomiting"],
        sputum: ["Sputum"],
        // GU commonly selected in Associated
        incontinence: ["Incontinence"],
        discharge: ["Discharge"],
        nocturia: ["Nocturia"],
        hematuria: ["Haematuria"],
        // Endocrine
        polyuria: ["Polyuria"],
        polydipsia: ["Polydipsia"],
      };

      // Utility: attach reactive listeners, observers, and polling to an enhanced <select>
      function attachReactiveSelect(selectEl, onChange) {
        if (!selectEl || typeof onChange !== "function") return;
        // Direct events
        selectEl.addEventListener("change", onChange, true);
        selectEl.addEventListener("input", onChange, true);
        selectEl.addEventListener("blur", onChange, true);
        // Observe DOM mutations (attributes/options/subtree)
        try {
          const obs = new MutationObserver(() =>
            setTimeout(() => onChange.call(selectEl), 0)
          );
          obs.observe(selectEl, {
            attributes: true,
            childList: true,
            subtree: true,
          });
        } catch (e) {
          console.warn("[SYMPTOM LINK] MutationObserver error:", e);
        }
        // Global interaction hooks to catch custom UI activity before it updates the select
        const trigger = () => setTimeout(() => onChange.call(selectEl), 0);
        const events = [
          "click",
          "mousedown",
          "mouseup",
          "keydown",
          "keyup",
          "touchend",
        ];
        events.forEach((ev) => document.addEventListener(ev, trigger, true));
        // Lightweight polling while the page is active to catch silent value updates
        try {
          let lastVals = [];
          const getVals = () =>
            selectEl.selectedOptions
              ? Array.from(selectEl.selectedOptions).map((o) => o.value)
              : selectEl.value
              ? [selectEl.value]
              : [];
          const poll = () => {
            try {
              const curr = getVals();
              if (
                curr.length !== lastVals.length ||
                curr.some((v, i) => v !== lastVals[i])
              ) {
                lastVals = curr.slice();
                onChange.call(selectEl);
              }
            } catch {}
          };
          // Store interval id to avoid duplicates
          if (!selectEl.__symptomPoller) {
            selectEl.__symptomPoller = setInterval(poll, 300);
          }
        } catch {}
        // Initial evaluation
        setTimeout(() => onChange.call(selectEl), 0);
      }

      // Listen for changes in Chief Complaint
      const ccSelect = document.getElementById("chief-complaint");
      if (ccSelect) {
        console.log("[SYMPTOM LINK] Chief Complaint select found");
        const onCCChange = function () {
          // Handle multiple selections via selectedOptions
          const values =
            this && this.selectedOptions
              ? Array.from(this.selectedOptions).map((o) => o.value)
              : this && this.value
              ? [this.value]
              : [];
          console.log("[SYMPTOM LINK] Chief Complaint changed to:", values);
          if (!values.length) return;
          values.forEach((val) => {
            if (symptomMappings[val]) {
              console.log(
                "[SYMPTOM LINK] Found mapping for CC:",
                val,
                "=>",
                symptomMappings[val]
              );
              checkROSSymptoms(symptomMappings[val]);
            } else {
              console.log("[SYMPTOM LINK] No mapping found for CC:", val);
            }
          });
        };
        attachReactiveSelect(ccSelect, onCCChange);
      } else {
        console.error("[SYMPTOM LINK] Chief Complaint select not found");
      }

      // Listen for changes in Associated Symptoms
      const assocSelect = document.getElementById("associated");
      if (assocSelect) {
        console.log("[SYMPTOM LINK] Associated Symptoms select found");
        const onAssocChange = function () {
          const values =
            this && this.selectedOptions
              ? Array.from(this.selectedOptions).map((o) => o.value)
              : this && this.value
              ? [this.value]
              : [];
          console.log("[SYMPTOM LINK] Associated Symptoms changed to:", values);
          if (!values.length) return;
          values.forEach((val) => {
            if (symptomMappings[val]) {
              console.log(
                "[SYMPTOM LINK] Found mapping for Associated:",
                val,
                "=>",
                symptomMappings[val]
              );
              checkROSSymptoms(symptomMappings[val]);
            } else {
              console.log(
                "[SYMPTOM LINK] No mapping found for Associated:",
                val
              );
            }
          });
        };
        attachReactiveSelect(assocSelect, onAssocChange);
      } else {
        console.error("[SYMPTOM LINK] Associated Symptoms select not found");
      }
    };

    window.checkROSSymptoms = function checkROSSymptoms(symptoms) {
      console.log("[SYMPTOM LINK] checkROSSymptoms called with:", symptoms);
      const rosCheckboxes = document.querySelectorAll(".ros");
      console.log(
        "[SYMPTOM LINK] Found",
        rosCheckboxes.length,
        "ROS checkboxes"
      );

      // Normalizer for synonyms and US/UK spellings
      const resolve = (s) => {
        if (!s) return s;
        const key = String(s).trim().toLowerCase();
        const map = {
          // breathing
          "shortness of breath": "Dyspnoea",
          dyspnea: "Dyspnoea",
          dyspnoea: "Dyspnoea",
          // spelling variants
          hemoptysis: "Haemoptysis",
          hematuria: "Haematuria",
          orthopnea: "Orthopnoea",
          diarrhea: "Diarrhea",
          diarrhoea: "Diarrhea",
          diarriha: "Diarrhea",
        };
        return map[key] || s;
      };

      const altMap = {
        Diarrhea: "Diarrhoea",
        Diarrhoea: "Diarrhea",
        Dyspnoea: "Shortness of breath",
        "Shortness of breath": "Dyspnoea",
        Haemoptysis: "Hemoptysis",
        Hemoptysis: "Haemoptysis",
        Orthopnoea: "Orthopnea",
        Orthopnea: "Orthopnoea",
        Haematuria: "Hematuria",
        Hematuria: "Haematuria",
      };

      symptoms.forEach((raw) => {
        const target = resolve(raw);
        console.log(
          "[SYMPTOM LINK] Looking for ROS checkbox with value:",
          target,
          "(from",
          raw,
          ")"
        );
        let found = false;

        // 1) Exact
        let cb = document.querySelector('.ros[value="' + target + '"]');
        // 2) Case-insensitive
        if (!cb) {
          const tLower = String(target).toLowerCase();
          cb =
            Array.from(rosCheckboxes).find(
              (x) => String(x.value).toLowerCase() === tLower
            ) || null;
        }
        // 3) Alternate spelling
        if (!cb && altMap[target]) {
          const alt = altMap[target];
          cb =
            document.querySelector('.ros[value="' + alt + '"]') ||
            Array.from(rosCheckboxes).find(
              (x) => String(x.value).toLowerCase() === String(alt).toLowerCase()
            ) ||
            null;
        }

        if (cb) {
          // Respect manual user uncheck
          if (cb.dataset.manual === "off") {
            console.log("[SYMPTOM LINK] Skipped (manual OFF):", cb.value);
          } else {
            console.log(
              "[SYMPTOM LINK] MATCH FOUND! Checking checkbox for:",
              cb.value
            );
            cb.checked = true;
            cb.dataset.autoAny = "1";
            found = true;
            cb.style.backgroundColor = "lightgreen";
            setTimeout(() => {
              cb.style.backgroundColor = "";
            }, 1000);
          }
        }
        if (!found) {
          console.log("[SYMPTOM LINK] NO MATCH FOUND for:", target);
        }
      });
    };

    // Initialize touch multi-select when page loads
    document.addEventListener("DOMContentLoaded", function () {
      console.log("[PE DEBUG] DOMContentLoaded fired");

      // Add a delay to ensure all elements are loaded
      setTimeout(() => {
        console.log("[SYMPTOM LINK] About to initialize symptom linking...");
        initSymptomLinking();
        console.log("[SYMPTOM LINK] Symptom linking initialization complete");
      }, 100);

      // Set initial PE section state (hidden by default)
      const peContent = document.getElementById("pe-content");
      if (peContent) {
        peContent.style.display = "none";
        peContent.style.opacity = "0";
        peContent.style.transition = "opacity 0.5s ease";
        console.log("[PE DEBUG] PE content hidden by default");
      } else {
        console.error("[PE DEBUG] pe-content not found on DOMContentLoaded");
      }
      // Don't initialize accordions here since PE is hidden - they'll be initialized when PE is shown
      console.log("[PE DEBUG] Skipping accordion init on load - PE is hidden");
      console.log(
        "[PE DEBUG] Global test functions available: testPEAccordions(), showPESection(), toggleFirstAccordion()"
      );
    });

    // Test if script is executing at all
    console.log("[SCRIPT TEST] JavaScript is executing");
    window.scriptTest = function () {
      return "Script works";
    };

    // Immediate test functions for console
    window.testSymptomLink = function () {
      console.log("[SYMPTOM LINK] Test function works!");
      return "Function is accessible";
    };

    console.log("[SCRIPT TEST] Test functions defined");

    // Working symptom linking functionality
    setTimeout(() => {
      console.log("[SYMPTOM LINK] Setting up symptom linking...");

      const symptomMap = {
        nausea: "Nausea",
        vomiting: "Vomiting",
        "nausea-cvs": "Nausea",
        "vomiting-cvs": "Vomiting",
        fever: "Fever",
        fatigue: "Fatigue",
        palpitations: "Palpitations",
        cough: "Cough",
        "chest-pain": "Chest pain",
        // Map UI term to actual ROS checkbox value
        "shortness-breath": "Dyspnoea",
        wheeze: "Wheeze",
        hemoptysis: "Haemoptysis",
        diarrhea: "Diarrhea",
        // safeguard common typo from UI if any
        diarriha: "Diarrhea",
        constipation: "Constipation",
        headache: "Headache",
        dizziness: "Dizziness",
        weakness: "Weakness",
        numbness: "Numbness",
        // sweating
        "night-sweats": "Night sweats",
        sweating: "Sweating",
        // Additional mappings to ROS
        sputum: "Sputum",
        melena: "Bleeding",
        hematochezia: "Bleeding",
        "gi-bleeding": "Bleeding",
        dysuria: "Dysuria",
        nocturia: "Nocturia",
        hematuria: "Haematuria",
        incontinence: "Incontinence",
        discharge: "Discharge",
        seizure: "Seizures",
        "memory-loss": "Memory loss",
        polyuria: "Polyuria",
        polydipsia: "Polydipsia",
      };

      // === Unchecking-aware linking ===
      // Track which ROS checkboxes were auto-set by each source
      const AUTO_ATTR = {
        cc: "autoCc",
        assoc: "autoAssoc",
      };

      // Keep previous desired sets to explicitly uncheck removed values
      const prevDesired = {
        cc: new Set(),
        assoc: new Set(),
      };

      // Find ROS checkbox by value with existing robust matching
      function findRosCheckbox(target) {
        if (!target) return null;
        // 1) exact
        let el = document.querySelector('.ros[value="' + target + '"]');
        if (el) return el;
        // 2) case-insensitive
        const tLower = String(target).toLowerCase();
        for (const cb of document.querySelectorAll(".ros")) {
          if (String(cb.value).toLowerCase() === tLower) return cb;
        }
        // 3) alternates
        const altMap = {
          Diarrhea: "Diarrhoea",
          Diarrhoea: "Diarrhea",
          Dyspnoea: "Shortness of breath",
          "Shortness of breath": "Dyspnoea",
          Haemoptysis: "Hemoptysis",
          Hemoptysis: "Haemoptysis",
          Orthopnoea: "Orthopnea",
          Orthopnea: "Orthopnoea",
          Haematuria: "Hematuria",
          Hematuria: "Haematuria",
        };
        const alt = altMap[target];
        if (alt) {
          return (
            document.querySelector('.ros[value="' + alt + '"]') ||
            Array.from(document.querySelectorAll(".ros")).find(
              (cb) =>
                String(cb.value).toLowerCase() === String(alt).toLowerCase()
            ) ||
            null
          );
        }
        return null;
      }

      // Normalize to ROS value when applicable
      function resolveToRosValue(s) {
        if (!s) return s;
        const key = String(s).trim().toLowerCase();
        const map = {
          "shortness of breath": "Dyspnoea",
          dyspnea: "Dyspnoea",
          dyspnoea: "Dyspnoea",
          hemoptysis: "Haemoptysis",
          hematuria: "Haematuria",
          orthopnea: "Orthopnoea",
          diarrhea: "Diarrhea",
          diarrhoea: "Diarrhea",
        };
        return map[key] || s;
      }

      // Sync helper: ensure ROS state matches desired set for a given source
      function syncRosForSource(source, desiredValues) {
        const attr = AUTO_ATTR[source];
        const otherAttr = source === "cc" ? AUTO_ATTR.assoc : AUTO_ATTR.cc;
        const desiredSet = new Set(
          (desiredValues || []).filter(Boolean).map((v) => resolveToRosValue(v))
        );

        // 0) Explicitly uncheck anything that was previously desired but is no longer desired
        const toRemove = [...prevDesired[source]].filter(
          (v) => !desiredSet.has(v)
        );
        toRemove.forEach((val) => {
          const cb = findRosCheckbox(val);
          if (cb) {
            // Clear this source's ownership, if set
            if (cb.dataset[attr] === "1") cb.dataset[attr] = "";
            // Only uncheck if no other source owns it
            if (cb.dataset[otherAttr] !== "1") {
              cb.checked = false;
              console.log(
                "[SYMPTOM LINK] Explicit uncheck (",
                source,
                "):",
                cb.value
              );
            }
          }
        });

        // Uncheck any previously auto-checked for this source that are no longer desired
        document.querySelectorAll(".ros").forEach((cb) => {
          if (cb.dataset[attr] === "1") {
            if (!desiredSet.has(cb.value)) {
              // Clear this source's ownership
              cb.dataset[attr] = "";
              // Only uncheck if no other source still owns it
              if (cb.dataset[otherAttr] !== "1") {
                cb.checked = false;
                console.log(
                  "[SYMPTOM LINK] Unchecked ROS (",
                  source,
                  "):",
                  cb.value
                );
              } else {
                console.log(
                  "[SYMPTOM LINK] Retained ROS due to other source (",
                  source,
                  "):",
                  cb.value
                );
              }
            }
          }
        });

        // Check all desired and mark ownership (respect manual + cooldown)
        desiredSet.forEach((val) => {
          const cb = findRosCheckbox(val);
          if (cb) {
            const now = Date.now();
            const manualAt = Number(cb.dataset.manualAt || 0);
            if (now - manualAt < 1200) {
              // user just changed it; don't fight them
              cb.dataset[attr] = "1";
              console.log("[SYMPTOM LINK] Cooldown skip for:", cb.value);
            } else if (cb.dataset.manual === "off") {
              // user explicitly turned it off; keep ownership but don't flip
              cb.dataset[attr] = "1";
              console.log(
                "[SYMPTOM LINK] Skipped due to manual OFF:",
                cb.value
              );
            } else if (cb.dataset.manual === "on") {
              // user explicitly turned it on; just record ownership
              cb.dataset[attr] = "1";
              console.log("[SYMPTOM LINK] Respecting manual ON:", cb.value);
            } else {
              cb.checked = true;
              cb.dataset[attr] = "1";
              cb.style.backgroundColor = "lightgreen";
              setTimeout(() => (cb.style.backgroundColor = ""), 600);
              console.log(
                "[SYMPTOM LINK] Checked ROS (",
                source,
                "):",
                cb.value
              );
            }
          } else {
            console.log("[SYMPTOM LINK] No ROS checkbox found for:", val);
          }
        });

        // Save current desired set for next diff
        prevDesired[source] = desiredSet;

        // Global cleanup: uncheck stale items not desired by any source and not manual
        const combinedDesired = new Set([
          ...prevDesired.cc,
          ...prevDesired.assoc,
        ]);
        document.querySelectorAll(".ros").forEach((cb) => {
          const val = cb.value;
          if (
            cb.checked &&
            !combinedDesired.has(val) &&
            cb.dataset[AUTO_ATTR.cc] !== "1" &&
            cb.dataset[AUTO_ATTR.assoc] !== "1" &&
            cb.dataset.manual !== "on" &&
            cb.dataset.manual !== "off"
          ) {
            cb.checked = false;
            console.log("[SYMPTOM LINK] Cleaned stale ROS check:", val);
          }
          // Clear manual override once no longer desired by any source
          if (
            !combinedDesired.has(val) &&
            (cb.dataset.manual === "on" || cb.dataset.manual === "off")
          ) {
            cb.dataset.manual = "";
            cb.dataset.manualAt = "";
            console.log("[SYMPTOM LINK] Cleared manual override for:", val);
          }
        });
      }

      // Delegated listener: track manual changes on any .ros checkbox
      document.addEventListener("change", function (e) {
        const t = e.target;
        if (t && t.classList && t.classList.contains("ros") && e.isTrusted) {
          t.dataset.manual = t.checked ? "on" : "off";
          t.dataset.manualAt = String(Date.now());
          console.log(
            "[SYMPTOM LINK] Manual change:",
            t.value,
            "=>",
            t.checked
          );
        }
      });

      // Chief Complaint linking (single select)
      const ccSelect = document.getElementById("chief-complaint");
      if (ccSelect) {
        ccSelect.addEventListener("change", function () {
          console.log("[SYMPTOM LINK] CC changed to:", this.value);
          const mapped = symptomMap[this.value];
          const desired = mapped ? [mapped] : [];
          syncRosForSource("cc", desired);
        });
      }

      // Associated Symptoms linking (may be multi-select)
      const assocSelect = document.getElementById("associated");
      if (assocSelect) {
        assocSelect.addEventListener("change", function () {
          // Collect all selected values if multi-select; else use current value
          let values = [];
          if (this.selectedOptions && this.selectedOptions.length) {
            values = Array.from(this.selectedOptions).map((o) => o.value);
          } else if (this.value) {
            values = [this.value];
          }
          const desired = [];
          values.forEach((v) => {
            const mapped = symptomMap[v];
            if (mapped) desired.push(mapped);
          });
          console.log("[SYMPTOM LINK] Associated desired ROS:", desired);
          syncRosForSource("assoc", desired);
        });
      }

      // Periodic reconciliation (covers custom dropdowns that don't fire change)
      (function setupSymptomReconciler() {
        const getAssocValues = (sel) => {
          if (!sel) return [];
          if (sel.selectedOptions && sel.selectedOptions.length) {
            return Array.from(sel.selectedOptions).map((o) => o.value);
          }
          return sel.value ? [sel.value] : [];
        };
        let lastCc = "__init__";
        let lastAssocKey = "__init__";
        setInterval(() => {
          const cc = ccSelect ? ccSelect.value || "" : "";
          const assocVals = getAssocValues(assocSelect);
          const assocKey = assocVals.sort().join("|");

          if (cc !== lastCc) {
            const mapped = symptomMap[cc];
            const desired = mapped ? [mapped] : [];
            syncRosForSource("cc", desired);
            lastCc = cc;
          }

          if (assocKey !== lastAssocKey) {
            const desired = [];
            assocVals.forEach((v) => {
              const mapped = symptomMap[v];
              if (mapped) desired.push(mapped);
            });
            syncRosForSource("assoc", desired);
            lastAssocKey = assocKey;
          }
        }, 700);
      })();

      function checkROSSymptom(symptomValue) {
        // Minimal resolver for synonyms and US/UK spellings
        const resolveToRosValue = (s) => {
          if (!s) return s;
          const key = String(s).trim().toLowerCase();
          const map = {
            // breathing
            "shortness of breath": "Dyspnoea",
            dyspnea: "Dyspnoea",
            dyspnoea: "Dyspnoea",
            // spelling variants
            hemoptysis: "Haemoptysis",
            hematuria: "Haematuria",
            orthopnea: "Orthopnoea",
            diarrhea: "Diarrhea", // primary target
            diarrhoea: "Diarrhea", // normalize to one spelling, with fallback below
          };
          return map[key] || s;
        };

        const target = resolveToRosValue(symptomValue);

        // 1) Try exact value match
        let rosCheckbox = document.querySelector(
          '.ros[value="' + target + '"]'
        );

        // 2) Case-insensitive fallback across all .ros values
        if (!rosCheckbox) {
          const all = document.querySelectorAll(".ros");
          const tLower = String(target).toLowerCase();
          all.forEach((cb) => {
            if (!rosCheckbox && String(cb.value).toLowerCase() === tLower) {
              rosCheckbox = cb;
            }
          });
        }

        // 3) Alternate spelling fallback for common pairs
        if (!rosCheckbox) {
          const altMap = {
            Diarrhea: "Diarrhoea",
            Diarrhoea: "Diarrhea",
            Dyspnoea: "Shortness of breath",
            "Shortness of breath": "Dyspnoea",
            Haemoptysis: "Hemoptysis",
            Hemoptysis: "Haemoptysis",
            Orthopnoea: "Orthopnea",
            Orthopnea: "Orthopnoea",
            Haematuria: "Hematuria",
            Hematuria: "Haematuria",
          };
          const alt = altMap[target];
          if (alt) {
            rosCheckbox =
              document.querySelector('.ros[value="' + alt + '"]') ||
              Array.from(document.querySelectorAll(".ros")).find(
                (cb) =>
                  String(cb.value).toLowerCase() === String(alt).toLowerCase()
              );
          }
        }

        if (rosCheckbox) {
          if (rosCheckbox.dataset.manual === "off") {
            console.log(
              "[SYMPTOM LINK] Skipped (manual OFF):",
              rosCheckbox.value
            );
            return;
          }
          rosCheckbox.checked = true;
          rosCheckbox.style.backgroundColor = "lightgreen";
          setTimeout(() => (rosCheckbox.style.backgroundColor = ""), 1000);
          console.log(
            "[SYMPTOM LINK] Checked ROS:",
            rosCheckbox.value,
            "(from:",
            symptomValue,
            ")"
          );
        } else {
          console.log(
            "[SYMPTOM LINK] ROS checkbox not found for:",
            symptomValue,
            "(normalized target:",
            target,
            ")"
          );
        }
      }

      console.log("[SYMPTOM LINK] Symptom linking setup complete");
    }, 500);

    // Warning box persistence functionality
    function closeWarningBox() {
      const warningBox = document.getElementById('warning-box');
      if (warningBox) {
        warningBox.style.display = 'none';
        // Save the closed state to localStorage
        localStorage.setItem('warningBoxClosed', 'true');
      }
    }

    // Check if warning box should be hidden on page load
    function checkWarningBoxState() {
      const warningBox = document.getElementById('warning-box');
      const isClosed = localStorage.getItem('warningBoxClosed') === 'true';
      
      if (warningBox && isClosed) {
        warningBox.style.display = 'none';
      }
    }

    // Initialize warning box state on page load
    document.addEventListener('DOMContentLoaded', checkWarningBoxState);
    // Also check immediately in case DOMContentLoaded already fired
    checkWarningBoxState();
  </script>
</div>
